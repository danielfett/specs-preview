<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>OAuth 2.0 Security Best Current Practice</title>
<meta content="Torsten Lodderstedt" name="author">
<meta content="John Bradley" name="author">
<meta content="Andrey Labunets" name="author">
<meta content="Daniel Fett" name="author">
<meta content="
       This document describes best current security practice for OAuth 2.0.
It updates and extends the OAuth 2.0 Security Threat Model to
incorporate practical experiences gathered since OAuth 2.0 was
published and covers new threats relevant due to the broader
application of OAuth 2.0. 
    " name="description">
<meta content="xml2rfc 2.40.1" name="generator">
<meta content="security" name="keyword">
<meta content="oauth2" name="keyword">
<meta content="best current practice" name="keyword">
<meta content="draft-ietf-oauth-security-topics-14" name="ietf.draft">
<link href="/output/draft-ietf-oauth-security-topics-14.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Avoid wrapping of URLs in references */
@media screen {
  .references a {
    white-space: nowrap;
  }
}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin: 0 0 0.25em 0;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/*
  The margin-left: 0 on <dd> removes all distinction
  between levels from nested <dl>s.  Undo that.
*/
dl.olPercent > dd,
dd {
  margin-left: revert;
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">oauth-security-topics</td>
<td class="right">July 2019</td>
</tr></thead>
<tfoot><tr>
<td class="left">Lodderstedt, et al.</td>
<td class="center">Expires 9 January 2020</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Web Authorization Protocol</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-oauth-security-topics-14</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2019-07-08" class="published">8 July 2019</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Best Current Practice</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2020-01-09">9 January 2020</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">T. Lodderstedt</div>
<div class="org">yes.com</div>
</div>
<div class="author">
      <div class="author-name">J. Bradley</div>
<div class="org">Yubico</div>
</div>
<div class="author">
      <div class="author-name">A. Labunets</div>
<div class="org">Facebook</div>
</div>
<div class="author">
      <div class="author-name">D. Fett</div>
<div class="org">yes.com</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">OAuth 2.0 Security Best Current Practice</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document describes best current security practice for OAuth 2.0.
It updates and extends the OAuth 2.0 Security Threat Model to
incorporate practical experiences gathered since OAuth 2.0 was
published and covers new threats relevant due to the broader
application of OAuth 2.0.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 9 January 2020.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2019 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a><a href="#section-toc.1-1.1.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1"><a href="#section-1.1" class="xref">1.1</a>.  <a href="#name-structure" class="xref">Structure</a><a href="#section-toc.1-1.1.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.1.2.2">
                <p id="section-toc.1-1.1.2.2.1"><a href="#section-1.2" class="xref">1.2</a>.  <a href="#name-conventions-and-terminology" class="xref">Conventions and Terminology</a><a href="#section-toc.1-1.1.2.2.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="xref">2</a>.  <a href="#name-recommendations" class="xref">Recommendations</a><a href="#section-toc.1-1.2.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1"><a href="#section-2.1" class="xref">2.1</a>.  <a href="#name-protecting-redirect-based-f" class="xref">Protecting Redirect-Based Flows</a><a href="#section-toc.1-1.2.2.1.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.2.2.1.2.1">
                    <p id="section-toc.1-1.2.2.1.2.1.1"><a href="#section-2.1.1" class="xref">2.1.1</a>.  <a href="#name-authorization-code-grant" class="xref">Authorization Code Grant</a><a href="#section-toc.1-1.2.2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.2.2.1.2.2">
                    <p id="section-toc.1-1.2.2.1.2.2.1"><a href="#section-2.1.2" class="xref">2.1.2</a>.  <a href="#name-implicit-grant" class="xref">Implicit Grant</a><a href="#section-toc.1-1.2.2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1"><a href="#section-2.2" class="xref">2.2</a>.  <a href="#name-token-replay-prevention" class="xref">Token Replay Prevention</a><a href="#section-toc.1-1.2.2.2.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.2.2.3">
                <p id="section-toc.1-1.2.2.3.1"><a href="#section-2.3" class="xref">2.3</a>.  <a href="#name-access-token-privilege-rest" class="xref">Access Token Privilege Restriction</a><a href="#section-toc.1-1.2.2.3.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.2.2.4">
                <p id="section-toc.1-1.2.2.4.1"><a href="#section-2.4" class="xref">2.4</a>.  <a href="#name-resource-owner-password-cre" class="xref">Resource Owner Password Credentials Grant</a><a href="#section-toc.1-1.2.2.4.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.2.2.5">
                <p id="section-toc.1-1.2.2.5.1"><a href="#section-2.5" class="xref">2.5</a>.  <a href="#name-client-authentication" class="xref">Client Authentication</a><a href="#section-toc.1-1.2.2.5.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.2.2.6">
                <p id="section-toc.1-1.2.2.6.1"><a href="#section-2.6" class="xref">2.6</a>.  <a href="#name-other-recommendations" class="xref">Other Recommendations</a><a href="#section-toc.1-1.2.2.6.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-the-updated-oauth-20-attack" class="xref">The Updated OAuth 2.0 Attacker Model</a><a href="#section-toc.1-1.3.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-attacks-and-mitigations" class="xref">Attacks and Mitigations</a><a href="#section-toc.1-1.4.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-insufficient-redirect-uri-v" class="xref">Insufficient Redirect URI Validation</a><a href="#section-toc.1-1.4.2.1.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.4.2.1.2.1">
                    <p id="section-toc.1-1.4.2.1.2.1.1"><a href="#section-4.1.1" class="xref">4.1.1</a>.  <a href="#name-redirect-uri-validation-att" class="xref">Redirect URI Validation Attacks on Authorization Code Grant</a><a href="#section-toc.1-1.4.2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.1.2.2">
                    <p id="section-toc.1-1.4.2.1.2.2.1"><a href="#section-4.1.2" class="xref">4.1.2</a>.  <a href="#name-redirect-uri-validation-atta" class="xref">Redirect URI Validation Attacks on Implicit Grant</a><a href="#section-toc.1-1.4.2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.1.2.3">
                    <p id="section-toc.1-1.4.2.1.2.3.1"><a href="#section-4.1.3" class="xref">4.1.3</a>.  <a href="#name-countermeasures" class="xref">Countermeasures</a><a href="#section-toc.1-1.4.2.1.2.3.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="xref">4.2</a>.  <a href="#name-credential-leakage-via-refe" class="xref">Credential Leakage via Referer Headers</a><a href="#section-toc.1-1.4.2.2.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.4.2.2.2.1">
                    <p id="section-toc.1-1.4.2.2.2.1.1"><a href="#section-4.2.1" class="xref">4.2.1</a>.  <a href="#name-leakage-from-the-oauth-clie" class="xref">Leakage from the OAuth Client</a><a href="#section-toc.1-1.4.2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.2.2.2">
                    <p id="section-toc.1-1.4.2.2.2.2.1"><a href="#section-4.2.2" class="xref">4.2.2</a>.  <a href="#name-leakage-from-the-authorizat" class="xref">Leakage from the Authorization Server</a><a href="#section-toc.1-1.4.2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.2.2.3">
                    <p id="section-toc.1-1.4.2.2.2.3.1"><a href="#section-4.2.3" class="xref">4.2.3</a>.  <a href="#name-consequences" class="xref">Consequences</a><a href="#section-toc.1-1.4.2.2.2.3.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.2.2.4">
                    <p id="section-toc.1-1.4.2.2.2.4.1"><a href="#section-4.2.4" class="xref">4.2.4</a>.  <a href="#name-countermeasures-2" class="xref">Countermeasures</a><a href="#section-toc.1-1.4.2.2.2.4.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="xref">4.3</a>.  <a href="#name-credential-leakage-via-brow" class="xref">Credential Leakage via Browser History</a><a href="#section-toc.1-1.4.2.3.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.4.2.3.2.1">
                    <p id="section-toc.1-1.4.2.3.2.1.1"><a href="#section-4.3.1" class="xref">4.3.1</a>.  <a href="#name-authorization-code-in-brows" class="xref">Authorization Code in Browser History</a><a href="#section-toc.1-1.4.2.3.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.3.2.2">
                    <p id="section-toc.1-1.4.2.3.2.2.1"><a href="#section-4.3.2" class="xref">4.3.2</a>.  <a href="#name-access-token-in-browser-his" class="xref">Access Token in Browser History</a><a href="#section-toc.1-1.4.2.3.2.2.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="xref">4.4</a>.  <a href="#name-mix-up-attacks" class="xref">Mix-Up Attacks</a><a href="#section-toc.1-1.4.2.4.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.4.2.4.2.1">
                    <p id="section-toc.1-1.4.2.4.2.1.1"><a href="#section-4.4.1" class="xref">4.4.1</a>.  <a href="#name-attack-description" class="xref">Attack Description</a><a href="#section-toc.1-1.4.2.4.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.4.2.2">
                    <p id="section-toc.1-1.4.2.4.2.2.1"><a href="#section-4.4.2" class="xref">4.4.2</a>.  <a href="#name-countermeasures-3" class="xref">Countermeasures</a><a href="#section-toc.1-1.4.2.4.2.2.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.5">
                <p id="section-toc.1-1.4.2.5.1"><a href="#section-4.5" class="xref">4.5</a>.  <a href="#name-authorization-code-injectio" class="xref">Authorization Code Injection</a><a href="#section-toc.1-1.4.2.5.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.4.2.5.2.1">
                    <p id="section-toc.1-1.4.2.5.2.1.1"><a href="#section-4.5.1" class="xref">4.5.1</a>.  <a href="#name-attack-description-2" class="xref">Attack Description</a><a href="#section-toc.1-1.4.2.5.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.5.2.2">
                    <p id="section-toc.1-1.4.2.5.2.2.1"><a href="#section-4.5.2" class="xref">4.5.2</a>.  <a href="#name-discussion" class="xref">Discussion</a><a href="#section-toc.1-1.4.2.5.2.2.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.5.2.3">
                    <p id="section-toc.1-1.4.2.5.2.3.1"><a href="#section-4.5.3" class="xref">4.5.3</a>.  <a href="#name-countermeasures-4" class="xref">Countermeasures</a><a href="#section-toc.1-1.4.2.5.2.3.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.5.2.4">
                    <p id="section-toc.1-1.4.2.5.2.4.1"><a href="#section-4.5.4" class="xref">4.5.4</a>.  <a href="#name-limitations" class="xref">Limitations</a><a href="#section-toc.1-1.4.2.5.2.4.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.6">
                <p id="section-toc.1-1.4.2.6.1"><a href="#section-4.6" class="xref">4.6</a>.  <a href="#name-access-token-injection" class="xref">Access Token Injection</a><a href="#section-toc.1-1.4.2.6.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.4.2.6.2.1">
                    <p id="section-toc.1-1.4.2.6.2.1.1"><a href="#section-4.6.1" class="xref">4.6.1</a>.  <a href="#name-countermeasures-5" class="xref">Countermeasures</a><a href="#section-toc.1-1.4.2.6.2.1.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.7">
                <p id="section-toc.1-1.4.2.7.1"><a href="#section-4.7" class="xref">4.7</a>.  <a href="#name-cross-site-request-forgery" class="xref">Cross Site Request Forgery</a><a href="#section-toc.1-1.4.2.7.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.4.2.7.2.1">
                    <p id="section-toc.1-1.4.2.7.2.1.1"><a href="#section-4.7.1" class="xref">4.7.1</a>.  <a href="#name-countermeasures-6" class="xref">Countermeasures</a><a href="#section-toc.1-1.4.2.7.2.1.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.8">
                <p id="section-toc.1-1.4.2.8.1"><a href="#section-4.8" class="xref">4.8</a>.  <a href="#name-access-token-leakage-at-the" class="xref">Access Token Leakage at the Resource Server</a><a href="#section-toc.1-1.4.2.8.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.4.2.8.2.1">
                    <p id="section-toc.1-1.4.2.8.2.1.1"><a href="#section-4.8.1" class="xref">4.8.1</a>.  <a href="#name-access-token-phishing-by-co" class="xref">Access Token Phishing by Counterfeit Resource Server</a><a href="#section-toc.1-1.4.2.8.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.8.2.2">
                    <p id="section-toc.1-1.4.2.8.2.2.1"><a href="#section-4.8.2" class="xref">4.8.2</a>.  <a href="#name-compromised-resource-server" class="xref">Compromised Resource Server</a><a href="#section-toc.1-1.4.2.8.2.2.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.9">
                <p id="section-toc.1-1.4.2.9.1"><a href="#section-4.9" class="xref">4.9</a>.  <a href="#name-open-redirection" class="xref">Open Redirection</a><a href="#section-toc.1-1.4.2.9.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.4.2.9.2.1">
                    <p id="section-toc.1-1.4.2.9.2.1.1"><a href="#section-4.9.1" class="xref">4.9.1</a>.  <a href="#name-client-as-open-redirector" class="xref">Client as Open Redirector</a><a href="#section-toc.1-1.4.2.9.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.9.2.2">
                    <p id="section-toc.1-1.4.2.9.2.2.1"><a href="#section-4.9.2" class="xref">4.9.2</a>.  <a href="#name-authorization-server-as-ope" class="xref">Authorization Server as Open Redirector</a><a href="#section-toc.1-1.4.2.9.2.2.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.10">
                <p id="section-toc.1-1.4.2.10.1"><a href="#section-4.10" class="xref">4.10</a>. <a href="#name-307-redirect" class="xref">307 Redirect</a><a href="#section-toc.1-1.4.2.10.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.11">
                <p id="section-toc.1-1.4.2.11.1"><a href="#section-4.11" class="xref">4.11</a>. <a href="#name-tls-terminating-reverse-pro" class="xref">TLS Terminating Reverse Proxies</a><a href="#section-toc.1-1.4.2.11.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.12">
                <p id="section-toc.1-1.4.2.12.1"><a href="#section-4.12" class="xref">4.12</a>. <a href="#name-refresh-token-protection" class="xref">Refresh Token Protection</a><a href="#section-toc.1-1.4.2.12.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.4.2.12.2.1">
                    <p id="section-toc.1-1.4.2.12.2.1.1"><a href="#section-4.12.1" class="xref">4.12.1</a>.  <a href="#name-discussion-2" class="xref">Discussion</a><a href="#section-toc.1-1.4.2.12.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.12.2.2">
                    <p id="section-toc.1-1.4.2.12.2.2.1"><a href="#section-4.12.2" class="xref">4.12.2</a>.  <a href="#name-recommendations-2" class="xref">Recommendations</a><a href="#section-toc.1-1.4.2.12.2.2.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.13">
                <p id="section-toc.1-1.4.2.13.1"><a href="#section-4.13" class="xref">4.13</a>. <a href="#name-client-impersonating-resour" class="xref">Client Impersonating Resource Owner</a><a href="#section-toc.1-1.4.2.13.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.4.2.13.2.1">
                    <p id="section-toc.1-1.4.2.13.2.1.1"><a href="#section-4.13.1" class="xref">4.13.1</a>.  <a href="#name-countermeasures-8" class="xref">Countermeasures</a><a href="#section-toc.1-1.4.2.13.2.1.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-acknowledgements" class="xref">Acknowledgements</a><a href="#section-toc.1-1.5.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-iana-considerations" class="xref">IANA Considerations</a><a href="#section-toc.1-1.6.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-security-considerations" class="xref">Security Considerations</a><a href="#section-toc.1-1.7.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-normative-references" class="xref">Normative References</a><a href="#section-toc.1-1.8.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-informative-references" class="xref">Informative References</a><a href="#section-toc.1-1.9.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-appendix.a" class="xref">Appendix A</a>.  <a href="#name-document-history" class="xref">Document History</a><a href="#section-toc.1-1.10.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-appendix.b" class="xref"></a><a href="#name-authors-addresses" class="xref">Authors' Addresses</a><a href="#section-toc.1-1.11.1" class="pilcrow">¶</a></p>
</li>
</ul>
</nav>
</section>
</div>
<div id="Introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">Since its publication in <span>[<a href="#RFC6749" class="xref">RFC6749</a>]</span> and <span>[<a href="#RFC6750" class="xref">RFC6750</a>]</span>, OAuth 2.0
("OAuth" in the following) has gotten massive traction in the market
and became the standard for API protection and the basis for federated
login using OpenID Connect <span>[<a href="#OpenID" class="xref">OpenID</a>]</span>. While OAuth is used in a
variety of scenarios and different kinds of deployments, the following
challenges can be observed:<a href="#section-1-1" class="pilcrow">¶</a></p>
<ul>
<li id="section-1-2.1">
          <p id="section-1-2.1.1">OAuth implementations are being attacked through known
implementation weaknesses and anti-patterns. Although most of
these threats are discussed in the OAuth 2.0 Threat Model and
Security Considerations <span>[<a href="#RFC6819" class="xref">RFC6819</a>]</span>, continued exploitation
demonstrates a need for more specific recommendations, easier to
implement mitigations, and more defense in depth.<a href="#section-1-2.1.1" class="pilcrow">¶</a></p>
</li>
<li id="section-1-2.2">
          <p id="section-1-2.2.1">OAuth is being used in environments with higher security
requirements than considered initially, such as Open Banking,
eHealth, eGovernment, and Electronic Signatures. Those use cases
call for stricter guidelines and additional protection.<a href="#section-1-2.2.1" class="pilcrow">¶</a></p>
</li>
<li id="section-1-2.3">
          <p id="section-1-2.3.1">OAuth is being used in much more dynamic setups than originally
anticipated, creating new challenges with respect to security.
Those challenges go beyond the original scope of <span>[<a href="#RFC6749" class="xref">RFC6749</a>]</span>,
<span>[<a href="#RFC6750" class="xref">RFC6750</a>]</span>, and <span>[<a href="#RFC6819" class="xref">RFC6819</a>]</span>.<a href="#section-1-2.3.1" class="pilcrow">¶</a></p>
<p id="section-1-2.3.2">OAuth initially assumed a static relationship between client,
authorization server and resource servers. The URLs of AS and RS were
known to the client at deployment time and built an anchor for the
trust relationship among those parties. The validation whether the
client talks to a legitimate server was based on TLS server
authentication (see <span>[<a href="#RFC6819" class="xref">RFC6819</a>]</span>, Section 4.5.4). With the increasing
adoption of OAuth, this simple model dissolved and, in several
scenarios, was replaced by a dynamic establishment of the relationship
between clients on one side and the authorization and resource servers
of a particular deployment on the other side. This way, the same
client could be used to access services of different providers (in
case of standard APIs, such as e-mail or OpenID Connect) or serve as a
frontend to a particular tenant in a multi-tenancy environment.
Extensions of OAuth, such as the OAuth 2.0 Dynamic Client Registration
Protocol <span>[<a href="#RFC7591" class="xref">RFC7591</a>]</span> and OAuth 2.0 Authorization Server Metadata
<span>[<a href="#RFC8414" class="xref">RFC8414</a>]</span> were developed in order to support the usage of OAuth in
dynamic scenarios.<a href="#section-1-2.3.2" class="pilcrow">¶</a></p>
</li>
<li id="section-1-2.4">
          <p id="section-1-2.4.1">Technology has changed. For example, the way browsers treat
fragments when redirecting requests has changed, and with it, the
implicit grant's underlying security model.<a href="#section-1-2.4.1" class="pilcrow">¶</a></p>
</li>
</ul>
<p id="section-1-3">This document provides updated security recommendations to address
these challenges. It does not supplant the security advice given in
<span>[<a href="#RFC6749" class="xref">RFC6749</a>]</span>, <span>[<a href="#RFC6750" class="xref">RFC6750</a>]</span>, and <span>[<a href="#RFC6819" class="xref">RFC6819</a>]</span>, but complements those
documents.<a href="#section-1-3" class="pilcrow">¶</a></p>
<div id="structure">
<section id="section-1.1">
        <h3 id="name-structure">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-structure" class="section-name selfRef">Structure</a>
        </h3>
<p id="section-1.1-1">The remainder of this document is organized as follows: The next
section summarizes the most important recommendations of the OAuth
working group for every OAuth implementor. Afterwards, the updated the
OAuth attacker model is presented. Subsequently, a detailed analysis
of the threats and implementation issues that can be found in the wild
today is given along with a discussion of potential countermeasures.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="conventions-and-terminology">
<section id="section-1.2">
        <h3 id="name-conventions-and-terminology">
<a href="#section-1.2" class="section-number selfRef">1.2. </a><a href="#name-conventions-and-terminology" class="section-name selfRef">Conventions and Terminology</a>
        </h3>
<p id="section-1.2-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED",
"MAY", and "OPTIONAL" in this document are to be interpreted as
described in BCP 14 <span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-1.2-1" class="pilcrow">¶</a></p>
<p id="section-1.2-2">This specification uses the terms "access token", "authorization
endpoint", "authorization grant", "authorization server", "client",
"client identifier" (client ID), "protected resource", "refresh
token", "resource owner", "resource server", and "token endpoint"
defined by OAuth 2.0 <span>[<a href="#RFC6749" class="xref">RFC6749</a>]</span>.<a href="#section-1.2-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="recommendations">
<section id="section-2">
      <h2 id="name-recommendations">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-recommendations" class="section-name selfRef">Recommendations</a>
      </h2>
<p id="section-2-1">This section describes the set of security mechanisms the OAuth
working group recommends to OAuth implementers.<a href="#section-2-1" class="pilcrow">¶</a></p>
<div id="rec_redirect">
<section id="section-2.1">
        <h3 id="name-protecting-redirect-based-f">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-protecting-redirect-based-f" class="section-name selfRef">Protecting Redirect-Based Flows</a>
        </h3>
<p id="section-2.1-1">When comparing client redirect URIs against pre-registered URIs,
authorization servers MUST utilize exact string matching. This measure
contributes to the prevention of leakage of authorization codes and
access tokens (depending on the grant type). It can also help to
detect mix-up attacks (see below).<a href="#section-2.1-1" class="pilcrow">¶</a></p>
<p id="section-2.1-2">Clients MUST NOT expose URLs that forward the user's browser to
arbitrary URIs obtained from a query parameter ("open redirector").
Open redirectors can enable exfiltration of authorization codes and
access tokens, see <a href="#open_redirector_on_client" class="xref">Section 4.9.1</a>.<a href="#section-2.1-2" class="pilcrow">¶</a></p>
<p id="section-2.1-3">Clients MUST prevent Cross-Site Request Forgery (CSRF). In this
context, CSRF refers to requests to the redirection endpoint that
do not originate at the authorization server, but a malicious third
party (see Section 4.4.1.8. of <span>[<a href="#RFC6819" class="xref">RFC6819</a>]</span> for details). One-time use
CSRF tokens carried in the <code>state</code> parameter that are securely bound
to the user agent SHOULD be used for that purpose. Alternatively, if
PKCE <span>[<a href="#RFC7636" class="xref">RFC7636</a>]</span> is used by the client and the client has ensured that
the authorization server supports PKCE, the client MAY opt to not use
<code>state</code> for CSRF protection, as such protection is provided by PKCE.
In this case, <code>state</code> MAY be used again for its original purpose,
namely transporting data about the application state of the client
(see <a href="#csrf_countermeasures" class="xref">Section 4.7.1</a>).<a href="#section-2.1-3" class="pilcrow">¶</a></p>
<p id="section-2.1-4">In order to prevent mix-up attacks, clients MUST only process redirect
responses of the authorization server they sent the respective request
to and from the same user agent this authorization request was
initiated with. Clients MUST store the authorization server they sent
an authorization request to and bind this information to the user
agent and check that the authorization request was received from the
correct authorization server. Clients MUST ensure that the subsequent
token request, if applicable, is sent to the same authorization
server. Clients SHOULD use distinct redirect URIs for each
authorization server as a means to identify the authorization server a
particular response came from.<a href="#section-2.1-4" class="pilcrow">¶</a></p>
<p id="section-2.1-5">An AS that redirects a request potentially containing user credentials
MUST avoid forwarding these user credentials accidentally (see
<a href="#redirect_307" class="xref">Section 4.10</a> for details).<a href="#section-2.1-5" class="pilcrow">¶</a></p>
<div id="ac">
<section id="section-2.1.1">
          <h4 id="name-authorization-code-grant">
<a href="#section-2.1.1" class="section-number selfRef">2.1.1. </a><a href="#name-authorization-code-grant" class="section-name selfRef">Authorization Code Grant</a>
          </h4>
<p id="section-2.1.1-1">Clients utilizing the authorization code grant type MUST use PKCE
<span>[<a href="#RFC7636" class="xref">RFC7636</a>]</span> or the OpenID Connect <code>nonce</code> parameter and ID Token Claim
<span>[<a href="#OpenID" class="xref">OpenID</a>]</span> to detect and prevent attempts to inject (replay)
authorization codes into the authorization response by an attacker.
The PKCE challenge or OpenID Connect <code>nonce</code> must be
transaction-specific and securely bound to the client and the user
agent in which the transaction was started.<a href="#section-2.1.1-1" class="pilcrow">¶</a></p>
<p id="section-2.1.1-2">Note: although PKCE so far was recommended as a mechanism to protect
native apps, this advice applies to all kinds of OAuth clients,
including web applications.<a href="#section-2.1.1-2" class="pilcrow">¶</a></p>
<p id="section-2.1.1-3">When using PKCE, clients SHOULD use PKCE code challenge methods that
do not expose the PKCE verifier in the authorization request.
Otherwise, attackers that can read the authorization request (cf.
Attacker A4 in <a href="#secmodel" class="xref">Section 3</a>) can trivially break the security provided
by PKCE. Currently, <code>S256</code> is the only such method.<a href="#section-2.1.1-3" class="pilcrow">¶</a></p>
<p id="section-2.1.1-4">Authorization servers MUST support PKCE <span>[<a href="#RFC7636" class="xref">RFC7636</a>]</span>.<a href="#section-2.1.1-4" class="pilcrow">¶</a></p>
<p id="section-2.1.1-5">Authorization servers MUST provide a way to detect their support for
PKCE. To this end, they MUST either (a) publish the element
<code>code_challenge_methods_supported</code> in their AS metadata (<span>[<a href="#RFC8418" class="xref">RFC8418</a>]</span>)
containing the supported PKCE challenge methods (which can be used by
the client to detect PKCE support) or (b) provide a
deployment-specific way to ensure or determine PKCE support by the AS.<a href="#section-2.1.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="implicit-grant">
<section id="section-2.1.2">
          <h4 id="name-implicit-grant">
<a href="#section-2.1.2" class="section-number selfRef">2.1.2. </a><a href="#name-implicit-grant" class="section-name selfRef">Implicit Grant</a>
          </h4>
<p id="section-2.1.2-1">The implicit grant (response type "token") and other response types
causing the authorization server to issue access tokens in the
authorization response are vulnerable to access token leakage and
access token replay as described in <a href="#insufficient_uri_validation" class="xref">Section 4.1</a>,
<a href="#credential_leakage_referrer" class="xref">Section 4.2</a>, <a href="#browser_history" class="xref">Section 4.3</a>, and
<a href="#access_token_injection" class="xref">Section 4.6</a>.<a href="#section-2.1.2-1" class="pilcrow">¶</a></p>
<p id="section-2.1.2-2">Moreover, no viable mechanism exists to cryptographically bind access
tokens issued in the authorization response to a certain client as it
is recommended in <a href="#token_replay_prevention" class="xref">Section 2.2</a>. This makes replay
detection for such access tokens at resource servers impossible.<a href="#section-2.1.2-2" class="pilcrow">¶</a></p>
<p id="section-2.1.2-3">In order to avoid these issues, clients SHOULD NOT use the implicit
grant (response type "token") or other response types issuing
access tokens in the authorization response, unless access token injection
in the authorization response is prevented and the aforementioned token leakage
vectors are mitigated.<a href="#section-2.1.2-3" class="pilcrow">¶</a></p>
<p id="section-2.1.2-4">Clients SHOULD instead use the response type "code" (aka authorization
code grant type) as specified in <a href="#ac" class="xref">Section 2.1.1</a> or any other response type that
causes the authorization server to issue access tokens in the token
response, such as the "code id_token" response type. This allows the
authorization server to detect replay attempts by attackers and
generally reduces the attack surface since access tokens are not
exposed in URLs. It also allows the authorization server to
sender-constrain the issued tokens (see next section).<a href="#section-2.1.2-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="token_replay_prevention">
<section id="section-2.2">
        <h3 id="name-token-replay-prevention">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-token-replay-prevention" class="section-name selfRef">Token Replay Prevention</a>
        </h3>
<p id="section-2.2-1">A sender-constrained access token scopes the applicability of an access
token to a certain sender. This sender is obliged to demonstrate knowledge
of a certain secret as prerequisite for the acceptance of that token at
the recipient (e.g., a resource server).<a href="#section-2.2-1" class="pilcrow">¶</a></p>
<p id="section-2.2-2">Authorization servers SHOULD use mechanisms for sender-constrained
access tokens as described in <a href="#pop_tokens" class="xref">Section 4.8.1.1.2</a>, such as Mutual TLS for
OAuth 2.0 <span>[<a href="#I-D.ietf-oauth-mtls" class="xref">I-D.ietf-oauth-mtls</a>]</span>, in order to prevent token replay.
Refresh tokens MUST be sender-constrained or use refresh token
rotation as described in <a href="#refresh_token_protection" class="xref">Section 4.12</a>.<a href="#section-2.2-2" class="pilcrow">¶</a></p>
<p id="section-2.2-3">It is RECOMMENDED to use end-to-end TLS. If TLS
traffic needs to be terminated at an intermediary, refer to
<a href="#tls_terminating" class="xref">Section 4.11</a> for further security advice.<a href="#section-2.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="access-token-privilege-restriction">
<section id="section-2.3">
        <h3 id="name-access-token-privilege-rest">
<a href="#section-2.3" class="section-number selfRef">2.3. </a><a href="#name-access-token-privilege-rest" class="section-name selfRef">Access Token Privilege Restriction</a>
        </h3>
<p id="section-2.3-1">The privileges associated with an access token SHOULD be restricted to
the minimum required for the particular application or use case. This
prevents clients from exceeding the privileges authorized by the
resource owner. It also prevents users from exceeding their privileges
authorized by the respective security policy. Privilege restrictions
also help to reduce the impact of access token leakage.<a href="#section-2.3-1" class="pilcrow">¶</a></p>
<p id="section-2.3-2">In particular, access tokens SHOULD be restricted to certain resource
servers (audience restriction), preferably to a single resource
server. To put this into effect, the authorization server associates
the access token with certain resource servers and every resource
server is obliged to verify, for every request, whether the access
token sent with that request was meant to be used for that particular
resource server. If not, the resource server MUST refuse to serve the
respective request. Clients and authorization servers MAY utilize the
parameters <code>scope</code> or <code>resource</code> as specified in <span>[<a href="#RFC6749" class="xref">RFC6749</a>]</span> and
<span>[<a href="#I-D.ietf-oauth-resource-indicators" class="xref">I-D.ietf-oauth-resource-indicators</a>]</span>, respectively, to determine the
resource server they want to access.<a href="#section-2.3-2" class="pilcrow">¶</a></p>
<p id="section-2.3-3">Additionally, access tokens SHOULD be restricted to certain resources
and actions on resource servers or resources. To put this into effect,
the authorization server associates the access token with the
respective resource and actions and every resource server is obliged
to verify, for every request, whether the access token sent with that
request was meant to be used for that particular action on the
particular resource. If not, the resource server must refuse to serve
the respective request. Clients and authorization servers MAY utilize
the parameter <code>scope</code> as specified in <span>[<a href="#RFC6749" class="xref">RFC6749</a>]</span> and <code>authorization_details</code> as specified in <span>[<a href="#I-D.ietf-oauth-rar" class="xref">I-D.ietf-oauth-rar</a>]</span> to determine those
resources and/or actions.<a href="#section-2.3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="resource-owner-password-credentials-grant">
<section id="section-2.4">
        <h3 id="name-resource-owner-password-cre">
<a href="#section-2.4" class="section-number selfRef">2.4. </a><a href="#name-resource-owner-password-cre" class="section-name selfRef">Resource Owner Password Credentials Grant</a>
        </h3>
<p id="section-2.4-1">The resource owner password credentials grant MUST NOT be used. This
grant type insecurely exposes the credentials of the resource owner to
the client. Even if the client is benign, this results in an increased
attack surface (credentials can leak in more places than just the AS)
and users are trained to enter their credentials in places other than
the AS.<a href="#section-2.4-1" class="pilcrow">¶</a></p>
<p id="section-2.4-2">Furthermore, adapting the resource owner password credentials grant to
two-factor authentication, authentication with cryptographic
credentials (cf. WebCrypto <span>[<a href="#webcrypto" class="xref">webcrypto</a>]</span>, WebAuthn <span>[<a href="#webauthn" class="xref">webauthn</a>]</span>), and
authentication processes that require multiple steps can be hard or
impossible.<a href="#section-2.4-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="client-authentication">
<section id="section-2.5">
        <h3 id="name-client-authentication">
<a href="#section-2.5" class="section-number selfRef">2.5. </a><a href="#name-client-authentication" class="section-name selfRef">Client Authentication</a>
        </h3>
<p id="section-2.5-1">Authorization servers SHOULD use client authentication.<a href="#section-2.5-1" class="pilcrow">¶</a></p>
<p id="section-2.5-2">It is RECOMMENDED to use asymmetric (public-key based) methods for
client authentication such as mTLS <span>[<a href="#I-D.ietf-oauth-mtls" class="xref">I-D.ietf-oauth-mtls</a>]</span> or
<code>private_key_jwt</code> <span>[<a href="#OpenID" class="xref">OpenID</a>]</span>. When asymmetric methods for client
authentication are used, authorization servers do not need to store
sensitive symmetric keys, making these methods more robust against a
number of attacks.<a href="#section-2.5-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="other-recommendations">
<section id="section-2.6">
        <h3 id="name-other-recommendations">
<a href="#section-2.6" class="section-number selfRef">2.6. </a><a href="#name-other-recommendations" class="section-name selfRef">Other Recommendations</a>
        </h3>
<p id="section-2.6-1">Authorization servers SHOULD NOT allow clients to influence their
<code>client_id</code> or <code>sub</code> value or any other claim that might cause
confusion with a genuine resource owner (see <a href="#client_impersonating" class="xref">Section 4.13</a>).<a href="#section-2.6-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="secmodel">
<section id="section-3">
      <h2 id="name-the-updated-oauth-20-attack">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-the-updated-oauth-20-attack" class="section-name selfRef">The Updated OAuth 2.0 Attacker Model</a>
      </h2>
<p id="section-3-1">In <span>[<a href="#RFC6819" class="xref">RFC6819</a>]</span>, an attacker model is laid out that describes the
capabilities of attackers against which OAuth deployments must be
protected. In the following, this attacker model is updated to account
for the potentially dynamic relationships involving multiple parties
(as described in <a href="#Introduction" class="xref">Section 1</a>), to include new types of attackers and to define
the attacker model more clearly.<a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2">OAuth MUST ensure that the authorization of the resource owner (RO)
(with a user agent) at the authorization server (AS) and the subsequent
usage of the access token at the resource server (RS) is protected at
least against the following attackers:<a href="#section-3-2" class="pilcrow">¶</a></p>
<ul>
<li id="section-3-3.1">
          <p id="section-3-3.1.1">(A1) Web Attackers that can set up and operate an arbitrary number
of network endpoints including browsers and servers (except for
the concrete RO, AS, and RS). Web attackers may set up web sites
that are visited by the RO, operate their own user agents, and
participate in the protocol.<a href="#section-3-3.1.1" class="pilcrow">¶</a></p>
<p id="section-3-3.1.2">Web attackers may, in particular, operate OAuth clients that are
registered at AS, and operate their own authorization and resource
servers that can be used (in parallel) by the RO and other
resource owners.<a href="#section-3-3.1.2" class="pilcrow">¶</a></p>
<p id="section-3-3.1.3">It must also be assumed that web attackers can lure the user to
open arbitrary attacker-chosen URIs at any time. In practice, this
can be achieved in many ways, for example, by injecting malicious
advertisements into advertisement networks, or by sending
legit-looking emails.<a href="#section-3-3.1.3" class="pilcrow">¶</a></p>
<p id="section-3-3.1.4">Web attackers can use their own user credentials to create new
messages as well as any secrets they learned previously. For
example, if a web attacker learns an authorization code of a user
through a misconfigured redirect URI, the web attacker can then
try to redeem that code for an access token.<a href="#section-3-3.1.4" class="pilcrow">¶</a></p>
<p id="section-3-3.1.5">They cannot, however, read or manipulate messages that are not
targeted towards them (e.g., sent to a URL controlled by a
non-attacker controlled AS).<a href="#section-3-3.1.5" class="pilcrow">¶</a></p>
</li>
<li id="section-3-3.2">
          <p id="section-3-3.2.1">(A2) Network Attackers that additionally have full control over
the network over which protocol participants communicate. They can
eavesdrop on, manipulate, and spoof messages, except when these
are properly protected by cryptographic methods (e.g., TLS).
Network attackers can also block arbitrary messages.<a href="#section-3-3.2.1" class="pilcrow">¶</a></p>
</li>
</ul>
<p id="section-3-4">While an example for a web attacker would be a customer of an internet
service provider, network attackers could be the internet service
provider itself, an attacker in a public (wifi) network using ARP
spoofing, or a state-sponsored attacker with access to internet
exchange points, for instance.<a href="#section-3-4" class="pilcrow">¶</a></p>
<p id="section-3-5">These attackers conform to the attacker model that was used in formal
analysis efforts for OAuth <span>[<a href="#arXiv.1601.01229" class="xref">arXiv.1601.01229</a>]</span>. This is a minimal
attacker model. Implementers MUST take into account all possible
attackers in the environment in which their OAuth implementations are
expected to run. Previous attacks on OAuth have shown that OAuth
deployments SHOULD in particular consider the following, stronger
attackers in addition to those listed above:<a href="#section-3-5" class="pilcrow">¶</a></p>
<ul>
<li id="section-3-6.1">
          <p id="section-3-6.1.1">(A3) Attackers that can read, but not modify, the contents of the
authorization response (i.e., the authorization response can leak
to an attacker).<a href="#section-3-6.1.1" class="pilcrow">¶</a></p>
<p id="section-3-6.1.2">Examples for such attacks include open redirector
attacks, problems existing on mobile operating systems (where
different apps can register themselves on the same URI), mix-up attacks (see <a href="#mix_up" class="xref">Section 4.4</a>), where the client is tricked into sending
credentials to a attacker-controlled AS, and the fact that URLs
are often stored/logged by browsers (history), proxy servers, and
operating systems.<a href="#section-3-6.1.2" class="pilcrow">¶</a></p>
</li>
<li id="section-3-6.2">
          <p id="section-3-6.2.1">(A4) Attackers that can read, but not modify, the contents of the
authorization request (i.e., the authorization request can leak,
in the same manner as above, to an attacker).<a href="#section-3-6.2.1" class="pilcrow">¶</a></p>
</li>
<li id="section-3-6.3">
          <p id="section-3-6.3.1">(A5) Attackers that can acquire an access token issued by AS. For
example, a resource server can be compromised by an attacker, an
access token may be sent to an attacker-controlled resource server
due to a misconfiguration, or an RO is social-engineered into
using a attacker-controlled RS. See also <a href="#comp_res_server" class="xref">Section 4.8.2</a>.<a href="#section-3-6.3.1" class="pilcrow">¶</a></p>
</li>
</ul>
<p id="section-3-7">(A3), (A4) and (A5) typically occur together with either (A1) or (A2).<a href="#section-3-7" class="pilcrow">¶</a></p>
<p id="section-3-8">Note that in this attacker model, an attacker (see A1) can be a RO or
act as one. For example, an attacker can use his own browser to replay
tokens or authorization codes obtained by any of the attacks described
above at the client or RS.<a href="#section-3-8" class="pilcrow">¶</a></p>
<p id="section-3-9">This document focusses on threats resulting from these attackers.
Attacks in an even stronger attacker model are discussed, for example,
in <span>[<a href="#arXiv.1901.11520" class="xref">arXiv.1901.11520</a>]</span>.<a href="#section-3-9" class="pilcrow">¶</a></p>
</section>
</div>
<div id="attacks-and-mitigations">
<section id="section-4">
      <h2 id="name-attacks-and-mitigations">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-attacks-and-mitigations" class="section-name selfRef">Attacks and Mitigations</a>
      </h2>
<p id="section-4-1">This section gives a detailed description of attacks on OAuth
implementations, along with potential countermeasures. Attacks and
mitigations already covered in <span>[<a href="#RFC6819" class="xref">RFC6819</a>]</span> are not listed here, except
where new recommendations are made.<a href="#section-4-1" class="pilcrow">¶</a></p>
<div id="insufficient_uri_validation">
<section id="section-4.1">
        <h3 id="name-insufficient-redirect-uri-v">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-insufficient-redirect-uri-v" class="section-name selfRef">Insufficient Redirect URI Validation</a>
        </h3>
<p id="section-4.1-1">Some authorization servers allow clients to register redirect URI
patterns instead of complete redirect URIs. The authorization servers
then match the redirect URI parameter value at the authorization
endpoint against the registered patterns at runtime. This approach
allows clients to encode transaction state into additional redirect
URI parameters or to register a single pattern for multiple
redirect URIs.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1-2">This approach turned out to be more complex to implement and more
error prone to manage than exact redirect URI matching. Several
successful attacks exploiting flaws in the pattern matching
implementation or concrete configurations have been observed in the
wild . Insufficient validation of the redirect URI effectively breaks
client identification or authentication (depending on grant and client
type) and allows the attacker to obtain an authorization code or
access token, either<a href="#section-4.1-2" class="pilcrow">¶</a></p>
<ul>
<li id="section-4.1-3.1">
            <p id="section-4.1-3.1.1">by directly sending the user agent to a URI under the attackers
control, or<a href="#section-4.1-3.1.1" class="pilcrow">¶</a></p>
</li>
<li id="section-4.1-3.2">
            <p id="section-4.1-3.2.1">by exposing the OAuth credentials to an attacker by utilizing an
open redirector at the client in conjunction with the way user
agents handle URL fragments.<a href="#section-4.1-3.2.1" class="pilcrow">¶</a></p>
</li>
</ul>
<p id="section-4.1-4">These attacks are shown in detail in the following subsections.<a href="#section-4.1-4" class="pilcrow">¶</a></p>
<div id="insufficient_uri_validation_acg">
<section id="section-4.1.1">
          <h4 id="name-redirect-uri-validation-att">
<a href="#section-4.1.1" class="section-number selfRef">4.1.1. </a><a href="#name-redirect-uri-validation-att" class="section-name selfRef">Redirect URI Validation Attacks on Authorization Code Grant</a>
          </h4>
<p id="section-4.1.1-1">For a client using the grant type code, an attack may work as
follows:<a href="#section-4.1.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1.1-2">Assume the redirect URL pattern <code>https://*.somesite.example/*</code> is
registered for the client with the client ID <code>s6BhdRkqt3</code>. The
intention is to allow any subdomain of <code>somesite.example</code> to be a
valid redirect URI for the client, for example
<code>https://app1.somesite.example/redirect</code>. A naive implementation on
the authorization server, however, might interpret the wildcard <code>*</code> as
"any character" and not "any character valid for a domain name". The
authorization server, therefore, might permit
<code>https://attacker.example/.somesite.example</code> as a redirect URI,
although <code>attacker.example</code> is a different domain potentially
controlled by a malicious party.<a href="#section-4.1.1-2" class="pilcrow">¶</a></p>
<p id="section-4.1.1-3">The attack can then be conducted as follows:<a href="#section-4.1.1-3" class="pilcrow">¶</a></p>
<p id="section-4.1.1-4">First, the attacker needs to trick the user into opening a tampered
URL in his browser that launches a page under the attacker's
control, say <code>https://www.evil.example</code> (see Attacker A1.)<a href="#section-4.1.1-4" class="pilcrow">¶</a></p>
<p id="section-4.1.1-5">This URL initiates the following authorization request with the client
ID of a legitimate client to the authorization endpoint (line breaks
for display only):<a href="#section-4.1.1-5" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.1.1-6">
<pre>GET /authorize?response_type=code&amp;client_id=s6BhdRkqt3&amp;state=9ad67f13
     &amp;redirect_uri=https%3A%2F%2Fattacker.example%2F.somesite.example
     HTTP/1.1
Host: server.somesite.example
</pre><a href="#section-4.1.1-6" class="pilcrow">¶</a>
</div>
<p id="section-4.1.1-7">The authorization server validates the redirect URI and compares it to
the registered redirect URL patterns for the client <code>s6BhdRkqt3</code>.
The authorization request is processed and presented to the user.<a href="#section-4.1.1-7" class="pilcrow">¶</a></p>
<p id="section-4.1.1-8">If the user does not see the redirect URI or does not recognize the
attack, the code is issued and immediately sent to the attacker's
domain. If an automatic approval of the authorization is enabled
(which is not recommended for public clients according to
<span>[<a href="#RFC6749" class="xref">RFC6749</a>]</span>), the attack can be performed even without user
interaction.<a href="#section-4.1.1-8" class="pilcrow">¶</a></p>
<p id="section-4.1.1-9">If the attacker impersonated a public client, the attacker can
exchange the code for tokens at the respective token endpoint.<a href="#section-4.1.1-9" class="pilcrow">¶</a></p>
<p id="section-4.1.1-10">This attack will not work as easily for confidential clients, since
the code exchange requires authentication with the legitimate client's
secret. The attacker can, however, use the legitimate confidential
client to redeem the code by performing an authorization code
injection attack, see <a href="#code_injection" class="xref">Section 4.5</a>.<a href="#section-4.1.1-10" class="pilcrow">¶</a></p>
<p id="section-4.1.1-11">Note: Vulnerabilities of this kind can also exist if the authorization
server handles wildcards properly. For example, assume that the client
registers the redirect URL pattern <code>https://*.somesite.example/*</code> and
the authorization server interprets this as "allow redirect URIs
pointing to any host residing in the domain <code>somesite.example</code>". If an
attacker manages to establish a host or subdomain in
<code>somesite.example</code>, he can impersonate the legitimate client. This
could be caused, for example, by a subdomain takeover attack <span>[<a href="#subdomaintakeover" class="xref">subdomaintakeover</a>]</span>, where an
outdated CNAME record (say, <code>external-service.somesite.example</code>)
points to an external DNS name that does no longer exist (say,
<code>customer-abc.service.example</code>) and can be taken over by an attacker
(e.g., by registering as <code>customer-abc</code> with the external service).<a href="#section-4.1.1-11" class="pilcrow">¶</a></p>
</section>
</div>
<div id="redir_uri_open_redir">
<section id="section-4.1.2">
          <h4 id="name-redirect-uri-validation-atta">
<a href="#section-4.1.2" class="section-number selfRef">4.1.2. </a><a href="#name-redirect-uri-validation-atta" class="section-name selfRef">Redirect URI Validation Attacks on Implicit Grant</a>
          </h4>
<p id="section-4.1.2-1">The attack described above works for the implicit grant as well. If
the attacker is able to send the authorization response to a URI under
his control, he will directly get access to the fragment carrying the
access token.<a href="#section-4.1.2-1" class="pilcrow">¶</a></p>
<p id="section-4.1.2-2">Additionally, implicit clients can be subject to a further kind of
attack. It utilizes the fact that user agents re-attach fragments to
the destination URL of a redirect if the location header does not
contain a fragment (see <span>[<a href="#RFC7231" class="xref">RFC7231</a>]</span>, Section 9.5). The attack
described here combines this behavior with the client as an open
redirector (see <a href="#open_redirector_on_client" class="xref">Section 4.9.1</a>) in order to get access to access tokens. This allows
circumvention even of very narrow redirect URI patterns, but not strict URL
matching.<a href="#section-4.1.2-2" class="pilcrow">¶</a></p>
<p id="section-4.1.2-3">Assume the registered URL pattern for client <code>s6BhdRkqt3</code> is
<code>https://client.somesite.example/cb?*</code>, i.e., any parameter is allowed
for redirects to <code>https://client.somesite.example/cb</code>. Unfortunately,
the client exposes an open redirector. This endpoint supports a
parameter <code>redirect_to</code> which takes a target URL and will send the
browser to this URL using an HTTP Location header redirect 303.<a href="#section-4.1.2-3" class="pilcrow">¶</a></p>
<p id="section-4.1.2-4">The attack can now be conducted as follows:<a href="#section-4.1.2-4" class="pilcrow">¶</a></p>
<p id="section-4.1.2-5">First, and as above, the attacker needs to trick the user into opening
a tampered URL in his browser that launches a page under the
attacker's control, say <code>https://www.evil.example</code>.<a href="#section-4.1.2-5" class="pilcrow">¶</a></p>
<p id="section-4.1.2-6">Afterwards, the website initiates an authorization request that is
very similar to the one in the attack on the code flow. Different to
above, it utilizes the open redirector by encoding
<code>redirect_to=https://client.evil.example</code> into the parameters of the
redirect URI and it uses the response type "token" (line breaks for display only):<a href="#section-4.1.2-6" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.1.2-7">
<pre>GET /authorize?response_type=token&amp;state=9ad67f13
    &amp;client_id=s6BhdRkqt3
    &amp;redirect_uri=https%3A%2F%2Fclient.somesite.example
     %2Fcb%26redirect_to%253Dhttps%253A%252F
     %252Fclient.evil.example%252F HTTP/1.1
Host: server.somesite.example
</pre><a href="#section-4.1.2-7" class="pilcrow">¶</a>
</div>
<p id="section-4.1.2-8">Now, since the redirect URI matches the registered pattern, the
authorization server permits the request and sends the resulting access
token in a 303 redirect (some response parameters omitted for
readability):<a href="#section-4.1.2-8" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.1.2-9">
<pre>HTTP/1.1 303 See Other
Location: https://client.somesite.example/cb?
          redirect_to%3Dhttps%3A%2F%2Fclient.evil.example%2Fcb
          #access_token=2YotnFZFEjr1zCsicMWpAA&amp;...
</pre><a href="#section-4.1.2-9" class="pilcrow">¶</a>
</div>
<p id="section-4.1.2-10">At example.com, the request arrives at the open redirector. The endpoint will
read the redirect parameter and will issue an HTTP 303 Location header
redirect to the URL <code>https://client.evil.example/</code>.<a href="#section-4.1.2-10" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.1.2-11">
<pre>HTTP/1.1 303 See Other
Location: https://client.evil.example/
</pre><a href="#section-4.1.2-11" class="pilcrow">¶</a>
</div>
<p id="section-4.1.2-12">Since the redirector at client.somesite.example does not include a
fragment in the Location header, the user agent will re-attach the
original fragment <code>#access_token=2YotnFZFEjr1zCsicMWpAA&amp;amp;...</code> to
the URL and will navigate to the following URL:<a href="#section-4.1.2-12" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.1.2-13">
<pre>https://client.evil.example/#access_token=2YotnFZFEjr1z...
</pre><a href="#section-4.1.2-13" class="pilcrow">¶</a>
</div>
<p id="section-4.1.2-14">The attacker's page at <code>client.evil.example</code> can now access the
fragment and obtain the access token.<a href="#section-4.1.2-14" class="pilcrow">¶</a></p>
</section>
</div>
<div id="countermeasures">
<section id="section-4.1.3">
          <h4 id="name-countermeasures">
<a href="#section-4.1.3" class="section-number selfRef">4.1.3. </a><a href="#name-countermeasures" class="section-name selfRef">Countermeasures</a>
          </h4>
<p id="section-4.1.3-1">The complexity of implementing and managing pattern matching correctly
obviously causes security issues. This document therefore advises to
simplify the required logic and configuration by using exact redirect
URI matching only. This means the authorization server MUST compare
the two URIs using simple string comparison as defined in <span>[<a href="#RFC3986" class="xref">RFC3986</a>]</span>,
Section 6.2.1.<a href="#section-4.1.3-1" class="pilcrow">¶</a></p>
<p id="section-4.1.3-2">Additional recommendations:<a href="#section-4.1.3-2" class="pilcrow">¶</a></p>
<ul>
<li id="section-4.1.3-3.1">
              <p id="section-4.1.3-3.1.1">Servers on which callbacks are hosted MUST NOT expose open
redirectors (see <a href="#open_redirection" class="xref">Section 4.9</a>).<a href="#section-4.1.3-3.1.1" class="pilcrow">¶</a></p>
</li>
<li id="section-4.1.3-3.2">
              <p id="section-4.1.3-3.2.1">Browsers reattach URL fragments to Location redirection URLs only
if the URL in the Location header does not already contain a fragment.
Therefore, servers MAY prevent browsers from reattaching fragments
to redirection URLs by attaching an arbitrary fragment identifier,
for example <code>#_</code>, to URLs in Location headers.<a href="#section-4.1.3-3.2.1" class="pilcrow">¶</a></p>
</li>
<li id="section-4.1.3-3.3">
              <p id="section-4.1.3-3.3.1">Clients SHOULD use the authorization code response type instead of
response types causing access token issuance at the authorization
endpoint. This offers countermeasures against reuse of leaked
credentials through the exchange process with the authorization
server and token replay through sender-constraining of the access
tokens.<a href="#section-4.1.3-3.3.1" class="pilcrow">¶</a></p>
</li>
</ul>
<p id="section-4.1.3-4">If the origin and integrity of the authorization request containing
the redirect URI can be verified, for example when using
<span>[<a href="#I-D.ietf-oauth-jwsreq" class="xref">I-D.ietf-oauth-jwsreq</a>]</span> or <span>[<a href="#I-D.ietf-oauth-par" class="xref">I-D.ietf-oauth-par</a>]</span> with client
authentication, the authorization server MAY trust the redirect URI
without further checks.<a href="#section-4.1.3-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="credential_leakage_referrer">
<section id="section-4.2">
        <h3 id="name-credential-leakage-via-refe">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-credential-leakage-via-refe" class="section-name selfRef">Credential Leakage via Referer Headers</a>
        </h3>
<p id="section-4.2-1">The contents of the authorization request URI or the authorization
response URI can unintentionally be disclosed to attackers through the
Referer HTTP header (see <span>[<a href="#RFC7231" class="xref">RFC7231</a>]</span>, Section 5.5.2), by leaking either
from the AS's or the client's web site, respectively. Most
importantly, authorization codes or <code>state</code> values can be disclosed in
this way. Although specified otherwise in <span>[<a href="#RFC7231" class="xref">RFC7231</a>]</span>, Section 5.5.2,
the same may happen to access tokens conveyed in URI fragments due to
browser implementation issues as illustrated by Chromium Issue 168213
<span>[<a href="#bug.chromium" class="xref">bug.chromium</a>]</span>.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<div id="leakage-from-the-oauth-client">
<section id="section-4.2.1">
          <h4 id="name-leakage-from-the-oauth-clie">
<a href="#section-4.2.1" class="section-number selfRef">4.2.1. </a><a href="#name-leakage-from-the-oauth-clie" class="section-name selfRef">Leakage from the OAuth Client</a>
          </h4>
<p id="section-4.2.1-1">Leakage from the OAuth client requires that the client, as a result of
a successful authorization request, renders a page that<a href="#section-4.2.1-1" class="pilcrow">¶</a></p>
<ul>
<li id="section-4.2.1-2.1">
              <p id="section-4.2.1-2.1.1">contains links to other pages under the attacker's control and a
user clicks on such a link, or<a href="#section-4.2.1-2.1.1" class="pilcrow">¶</a></p>
</li>
<li id="section-4.2.1-2.2">
              <p id="section-4.2.1-2.2.1">includes third-party content (advertisements in iframes, images,
etc.), for example if the page contains user-generated content
(blog).<a href="#section-4.2.1-2.2.1" class="pilcrow">¶</a></p>
</li>
</ul>
<p id="section-4.2.1-3">As soon as the browser navigates to the attacker's page or loads the
third-party content, the attacker receives the authorization response
URL and can extract <code>code</code> or <code>state</code> (and potentially <code>access token</code>).<a href="#section-4.2.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="leakage-from-the-authorization-server">
<section id="section-4.2.2">
          <h4 id="name-leakage-from-the-authorizat">
<a href="#section-4.2.2" class="section-number selfRef">4.2.2. </a><a href="#name-leakage-from-the-authorizat" class="section-name selfRef">Leakage from the Authorization Server</a>
          </h4>
<p id="section-4.2.2-1">In a similar way, an attacker can learn <code>state</code> from the authorization
request if the authorization endpoint at the authorization server
contains links or third-party content as above.<a href="#section-4.2.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="consequences">
<section id="section-4.2.3">
          <h4 id="name-consequences">
<a href="#section-4.2.3" class="section-number selfRef">4.2.3. </a><a href="#name-consequences" class="section-name selfRef">Consequences</a>
          </h4>
<p id="section-4.2.3-1">An attacker that learns a valid code or access token through a
Referer header can perform the attacks as described in
<a href="#insufficient_uri_validation_acg" class="xref">Section 4.1.1</a>, <a href="#code_injection" class="xref">Section 4.5</a>, and
<a href="#access_token_injection" class="xref">Section 4.6</a>. If the attacker learns <code>state</code>, the CSRF
protection achieved by using <code>state</code> is lost, resulting in CSRF
attacks as described in <span>[<a href="#RFC6819" class="xref">RFC6819</a>]</span>, Section 4.4.1.8.<a href="#section-4.2.3-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="countermeasures-1">
<section id="section-4.2.4">
          <h4 id="name-countermeasures-2">
<a href="#section-4.2.4" class="section-number selfRef">4.2.4. </a><a href="#name-countermeasures-2" class="section-name selfRef">Countermeasures</a>
          </h4>
<p id="section-4.2.4-1">The page rendered as a result of the OAuth authorization response and
the authorization endpoint SHOULD NOT include third-party resources or
links to external sites.<a href="#section-4.2.4-1" class="pilcrow">¶</a></p>
<p id="section-4.2.4-2">The following measures further reduce the chances of a successful attack:<a href="#section-4.2.4-2" class="pilcrow">¶</a></p>
<ul>
<li id="section-4.2.4-3.1">
              <p id="section-4.2.4-3.1.1">Suppress the Referer header by applying an appropriate Referrer
Policy <span>[<a href="#webappsec-referrer-policy" class="xref">webappsec-referrer-policy</a>]</span> to the document (either as
part of the "referrer" meta attribute or by setting a
Referrer-Policy header). For example, the header <code>Referrer-Policy:
no-referrer</code> in the response completely suppresses the Referer
header in all requests originating from the resulting document.<a href="#section-4.2.4-3.1.1" class="pilcrow">¶</a></p>
</li>
<li id="section-4.2.4-3.2">
              <p id="section-4.2.4-3.2.1">Use authorization code instead of response types causing access
token issuance from the authorization endpoint.<a href="#section-4.2.4-3.2.1" class="pilcrow">¶</a></p>
</li>
<li id="section-4.2.4-3.3">
              <p id="section-4.2.4-3.3.1">Bind authorization code to a confidential client or PKCE
challenge. In this case, the attacker lacks the secret to request
the code exchange.<a href="#section-4.2.4-3.3.1" class="pilcrow">¶</a></p>
</li>
<li id="section-4.2.4-3.4">
              <p id="section-4.2.4-3.4.1">As described in <span>[<a href="#RFC6749" class="xref">RFC6749</a>]</span>, Section 4.1.2, authorization codes
MUST be invalidated by the AS after their first use at the token
endpoint. For example, if an AS invalidated the code after the
legitimate client redeemed it, the attacker would fail exchanging
this code later.<a href="#section-4.2.4-3.4.1" class="pilcrow">¶</a></p>
<p id="section-4.2.4-3.4.2">This does not mitigate the attack if the attacker manages to
exchange the code for a token before the legitimate client does
so. Therefore, <span>[<a href="#RFC6749" class="xref">RFC6749</a>]</span> further recommends that, when an
attempt is made to redeem a code twice, the AS SHOULD revoke all
tokens issued previously based on that code.<a href="#section-4.2.4-3.4.2" class="pilcrow">¶</a></p>
</li>
<li id="section-4.2.4-3.5">
              <p id="section-4.2.4-3.5.1">The <code>state</code> value SHOULD be invalidated by the client after its
first use at the redirection endpoint. If this is implemented, and
an attacker receives a token through the Referer header from the
client's web site, the <code>state</code> was already used, invalidated by
the client and cannot be used again by the attacker. (This does
not help if the <code>state</code> leaks from the
AS's web site, since then the <code>state</code>
has not been used at the redirection endpoint at the client yet.)<a href="#section-4.2.4-3.5.1" class="pilcrow">¶</a></p>
</li>
<li id="section-4.2.4-3.6">
              <p id="section-4.2.4-3.6.1">Use the form post response mode instead of a redirect for the
authorization response (see <span>[<a href="#oauth-v2-form-post-response-mode" class="xref">oauth-v2-form-post-response-mode</a>]</span>).<a href="#section-4.2.4-3.6.1" class="pilcrow">¶</a></p>
</li>
</ul>
</section>
</div>
</section>
</div>
<div id="browser_history">
<section id="section-4.3">
        <h3 id="name-credential-leakage-via-brow">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-credential-leakage-via-brow" class="section-name selfRef">Credential Leakage via Browser History</a>
        </h3>
<p id="section-4.3-1">Authorization codes and access tokens can end up in the browser's
history of visited URLs, enabling the attacks described in the
following.<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<div id="authorization-code-in-browser-history">
<section id="section-4.3.1">
          <h4 id="name-authorization-code-in-brows">
<a href="#section-4.3.1" class="section-number selfRef">4.3.1. </a><a href="#name-authorization-code-in-brows" class="section-name selfRef">Authorization Code in Browser History</a>
          </h4>
<p id="section-4.3.1-1">When a browser navigates to
<code>client.example/redirection_endpoint?code=abcd</code> as a result of a
redirect from a provider's authorization endpoint, the URL including
the authorization code may end up in the browser's history. An
attacker with access to the device could obtain the code and try to
replay it.<a href="#section-4.3.1-1" class="pilcrow">¶</a></p>
<p id="section-4.3.1-2">Countermeasures:<a href="#section-4.3.1-2" class="pilcrow">¶</a></p>
<ul>
<li id="section-4.3.1-3.1">
              <p id="section-4.3.1-3.1.1">Authorization code replay prevention as described in <span>[<a href="#RFC6819" class="xref">RFC6819</a>]</span>,
Section 4.4.1.1, and <a href="#code_injection" class="xref">Section 4.5</a>.<a href="#section-4.3.1-3.1.1" class="pilcrow">¶</a></p>
</li>
<li id="section-4.3.1-3.2">
              <p id="section-4.3.1-3.2.1">Use form post response mode instead of redirect for the authorization
response (see <span>[<a href="#oauth-v2-form-post-response-mode" class="xref">oauth-v2-form-post-response-mode</a>]</span>).<a href="#section-4.3.1-3.2.1" class="pilcrow">¶</a></p>
</li>
</ul>
</section>
</div>
<div id="access-token-in-browser-history">
<section id="section-4.3.2">
          <h4 id="name-access-token-in-browser-his">
<a href="#section-4.3.2" class="section-number selfRef">4.3.2. </a><a href="#name-access-token-in-browser-his" class="section-name selfRef">Access Token in Browser History</a>
          </h4>
<p id="section-4.3.2-1">An access token may end up in the browser history if a client or a web
site that already has a token deliberately navigates to a page like
<code>provider.com/get_user_profile?access_token=abcdef</code>. <span>[<a href="#RFC6750" class="xref">RFC6750</a>]</span>
discourages this practice and advises to transfer tokens via a header,
but in practice web sites often pass access tokens in query
parameters.<a href="#section-4.3.2-1" class="pilcrow">¶</a></p>
<p id="section-4.3.2-2">In case of the implicit grant, a URL like
<code>client.example/redirection_endpoint#access_token=abcdef</code> may also end
up in the browser history as a result of a redirect from a provider's
authorization endpoint.<a href="#section-4.3.2-2" class="pilcrow">¶</a></p>
<p id="section-4.3.2-3">Countermeasures:<a href="#section-4.3.2-3" class="pilcrow">¶</a></p>
<ul>
<li id="section-4.3.2-4.1">
              <p id="section-4.3.2-4.1.1">Clients MUST NOT pass access tokens in a URI query parameter in
the way described in Section 2.3 of <span>[<a href="#RFC6750" class="xref">RFC6750</a>]</span>. The authorization
code grant or alternative OAuth response modes like the form post
response mode <span>[<a href="#oauth-v2-form-post-response-mode" class="xref">oauth-v2-form-post-response-mode</a>]</span> can be used to
this end.<a href="#section-4.3.2-4.1.1" class="pilcrow">¶</a></p>
</li>
</ul>
</section>
</div>
</section>
</div>
<div id="mix_up">
<section id="section-4.4">
        <h3 id="name-mix-up-attacks">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-mix-up-attacks" class="section-name selfRef">Mix-Up Attacks</a>
        </h3>
<p id="section-4.4-1">Mix-up is an attack on scenarios where an OAuth client interacts with
two or more authorization servers and at least one authorization
server is under the control of the attacker. This can be the case,
for example, if the attacker uses dynamic registration to register the
client at his own authorization server or if an authorization server
becomes compromised.<a href="#section-4.4-1" class="pilcrow">¶</a></p>
<p id="section-4.4-2">The goal of the attack is to obtain an authorization code or an access
token for an uncompromised authorization server. This is achieved by
tricking the client into sending those credentials to the compromised
authorization server (the attacker) instead of using them at the
respective endpoint of the uncompromised authorization/resource
server.<a href="#section-4.4-2" class="pilcrow">¶</a></p>
<div id="attack-description">
<section id="section-4.4.1">
          <h4 id="name-attack-description">
<a href="#section-4.4.1" class="section-number selfRef">4.4.1. </a><a href="#name-attack-description" class="section-name selfRef">Attack Description</a>
          </h4>
<p id="section-4.4.1-1">For a more detailed attack description, refer to <span>[<a href="#arXiv.1601.01229" class="xref">arXiv.1601.01229</a>]</span>
and <span>[<a href="#I-D.ietf-oauth-mix-up-mitigation" class="xref">I-D.ietf-oauth-mix-up-mitigation</a>]</span>. The description here closely
follows <span>[<a href="#arXiv.1601.01229" class="xref">arXiv.1601.01229</a>]</span>, with variants of the attack outlined
below.<a href="#section-4.4.1-1" class="pilcrow">¶</a></p>
<p id="section-4.4.1-2">Preconditions: For this variant of the attack to work, we assume that<a href="#section-4.4.1-2" class="pilcrow">¶</a></p>
<ul>
<li id="section-4.4.1-3.1">
              <p id="section-4.4.1-3.1.1">the implicit or authorization code grant are used with multiple AS
of which one is considered "honest" (H-AS) and one is operated by
the attacker (A-AS),<a href="#section-4.4.1-3.1.1" class="pilcrow">¶</a></p>
</li>
<li id="section-4.4.1-3.2">
              <p id="section-4.4.1-3.2.1">the client stores the AS chosen by the user in a session bound to
the user's browser and uses the same redirection endpoint URI for
each AS, and<a href="#section-4.4.1-3.2.1" class="pilcrow">¶</a></p>
</li>
<li id="section-4.4.1-3.3">
              <p id="section-4.4.1-3.3.1">the attacker can intercept and manipulate the first
request/response pair from a user's browser to the client (in
which the user selects a certain AS and is then redirected by the
client to that AS), as in Attacker A2.<a href="#section-4.4.1-3.3.1" class="pilcrow">¶</a></p>
</li>
</ul>
<p id="section-4.4.1-4">The latter ability can, for example, be the result of a
man-in-the-middle attack on the user's connection to the client. Note
that an attack variant exists that does not require this ability, see
below.<a href="#section-4.4.1-4" class="pilcrow">¶</a></p>
<p id="section-4.4.1-5">In the following, we assume that the client is registered with H-AS
(URI: <code>https://honest.as.example</code>, client ID: <code>7ZGZldHQ</code>) and with
A-AS (URI: <code>https://attacker.example</code>, client ID: <code>666RVZJTA</code>).<a href="#section-4.4.1-5" class="pilcrow">¶</a></p>
<p id="section-4.4.1-6">Attack on the authorization code grant:<a href="#section-4.4.1-6" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.4.1-7">
            <li id="section-4.4.1-7.1">
              <p id="section-4.4.1-7.1.1">The user selects to start the grant using H-AS (e.g., by clicking on a button at the
client's website).<a href="#section-4.4.1-7.1.1" class="pilcrow">¶</a></p>
</li>
<li id="section-4.4.1-7.2">
              <p id="section-4.4.1-7.2.1">The attacker intercepts this request and changes the user's
selection to "A-AS" (see preconditions).<a href="#section-4.4.1-7.2.1" class="pilcrow">¶</a></p>
</li>
<li id="section-4.4.1-7.3">
              <p id="section-4.4.1-7.3.1">The client stores in the user's session that the user selected
"A-AS" and redirects the user to A-AS's authorization endpoint
with a Location header containing the URL
<code>https://attacker.example/authorize?response_type=code&amp;client_id=666RVZJTA</code>.<a href="#section-4.4.1-7.3.1" class="pilcrow">¶</a></p>
</li>
<li id="section-4.4.1-7.4">
              <p id="section-4.4.1-7.4.1">Now the attacker intercepts this response and changes the
redirection such that the user is being redirected to H-AS. The
attacker also replaces the client ID of the client at A-AS with
the client's ID at H-AS. Therefore, the browser receives a
redirection (<code>303 See Other</code>) with a Location header pointing to
<code>https://honest.as.example/authorize?response_type=code&amp;client_id=7ZGZldHQ</code><a href="#section-4.4.1-7.4.1" class="pilcrow">¶</a></p>
</li>
<li id="section-4.4.1-7.5">
              <p id="section-4.4.1-7.5.1">The user authorizes the client to access her resources at
H-AS. H-AS issues a code and sends it (via the browser) back to
the client.<a href="#section-4.4.1-7.5.1" class="pilcrow">¶</a></p>
</li>
<li id="section-4.4.1-7.6">
              <p id="section-4.4.1-7.6.1">Since the client still assumes that the code was issued by A-AS,
it will try to redeem the code at A-AS's token endpoint.<a href="#section-4.4.1-7.6.1" class="pilcrow">¶</a></p>
</li>
<li id="section-4.4.1-7.7">
              <p id="section-4.4.1-7.7.1">The attacker therefore obtains code and can either exchange the
code for an access token (for public clients) or perform an
authorization code injection attack as described in
<a href="#code_injection" class="xref">Section 4.5</a>.<a href="#section-4.4.1-7.7.1" class="pilcrow">¶</a></p>
</li>
</ol>
<p id="section-4.4.1-8">Variants:<a href="#section-4.4.1-8" class="pilcrow">¶</a></p>
<ul>
<li id="section-4.4.1-9.1">
              <p id="section-4.4.1-9.1.1"><strong>Mix-Up Without Interception</strong>: A variant of the above attack
works even if the first request/response pair cannot be
intercepted, for example, because TLS is used to protect these
messages: Here, it is assumed that the user wants to start the
grant using A-AS (and not H-AS, see Attacker A1). After the client
redirected the user to the authorization endpoint at A-AS, the
attacker immediately redirects the user to H-AS (changing the
client ID to <code>7ZGZldHQ</code>). Note that a vigilant user might at this
point detect that she intended to use A-AS instead of H-AS. The
attack now proceeds exactly as in Steps 3ff. of the attack
description above.<a href="#section-4.4.1-9.1.1" class="pilcrow">¶</a></p>
</li>
<li id="section-4.4.1-9.2">
              <p id="section-4.4.1-9.2.1"><strong>Implicit Grant</strong>: In the implicit grant, the attacker receives
an access token instead of the code; the rest of the attack works
as above.<a href="#section-4.4.1-9.2.1" class="pilcrow">¶</a></p>
</li>
<li id="section-4.4.1-9.3">
              <p id="section-4.4.1-9.3.1"><strong>Per-AS Redirect URIs</strong>: If clients use different redirect URIs
for different ASs, do not store the selected AS in the user's
session, and ASs do not check the redirect URIs properly,
attackers can mount an attack called "Cross-Social Network Request
Forgery". These attacks have been observed in practice. Refer to <span>[<a href="#oauth_security_jcs_14" class="xref">oauth_security_jcs_14</a>]</span> for details.<a href="#section-4.4.1-9.3.1" class="pilcrow">¶</a></p>
</li>
<li id="section-4.4.1-9.4">
              <p id="section-4.4.1-9.4.1"><strong>OpenID Connect</strong>: There are variants that can be used to attack
OpenID Connect. In these attacks, the attacker misuses features of
the OpenID Connect Discovery mechanism or replays access tokens or
ID Tokens to conduct a Mix-Up Attack. The attacks are described in
detail in <span>[<a href="#arXiv.1704.08539" class="xref">arXiv.1704.08539</a>]</span>, Appendix A, and
<span>[<a href="#arXiv.1508.04324v2" class="xref">arXiv.1508.04324v2</a>]</span>, Section 6 ("Malicious Endpoints Attacks").<a href="#section-4.4.1-9.4.1" class="pilcrow">¶</a></p>
</li>
</ul>
</section>
</div>
<div id="countermeasures-2">
<section id="section-4.4.2">
          <h4 id="name-countermeasures-3">
<a href="#section-4.4.2" class="section-number selfRef">4.4.2. </a><a href="#name-countermeasures-3" class="section-name selfRef">Countermeasures</a>
          </h4>
<p id="section-4.4.2-1">In scenarios where an OAuth client interacts with multiple
authorization servers, clients MUST prevent mix-up attacks.<a href="#section-4.4.2-1" class="pilcrow">¶</a></p>
<p id="section-4.4.2-2">To this end, clients SHOULD use distinct redirect URIs for each AS
(with alternatives listed below). Clients MUST store, for each
authorization request, the AS they sent the authorization request to
and bind this information to the user agent. Clients MUST check that
the authorization request was received from the correct authorization
server and ensure that the subsequent token request, if applicable, is
sent to the same authorization server.<a href="#section-4.4.2-2" class="pilcrow">¶</a></p>
<p id="section-4.4.2-3">Unfortunately, distinct redirect URIs per AS do not work for all kinds
of OAuth clients. They are effective for web and JavaScript apps and
for native apps with claimed URLs. Attacks on native apps using custom
schemes or redirect URIs on localhost cannot be prevented this way.<a href="#section-4.4.2-3" class="pilcrow">¶</a></p>
<p id="section-4.4.2-4">If clients cannot use distinct redirect URIs for each AS, the following options exist:<a href="#section-4.4.2-4" class="pilcrow">¶</a></p>
<ul>
<li id="section-4.4.2-5.1">
              <p id="section-4.4.2-5.1.1">Authorization servers can be configured to return an AS
identitifier (<code>iss</code>) as a non-standard parameter in the
authorization response. This enables complying clients to compare
this data to the <code>iss</code> identifier of the AS it believed it sent
the user agent to. This mitigation is discussed in detail in
<span>[<a href="#I-D.ietf-oauth-mix-up-mitigation" class="xref">I-D.ietf-oauth-mix-up-mitigation</a>]</span>.<a href="#section-4.4.2-5.1.1" class="pilcrow">¶</a></p>
</li>
<li id="section-4.4.2-5.2">
              <p id="section-4.4.2-5.2.1">In OpenID Connect, if an ID Token is returned in the authorization
response, it carries client ID and issuer. It can be used in the
same way as the <code>iss</code> parameter.<a href="#section-4.4.2-5.2.1" class="pilcrow">¶</a></p>
</li>
</ul>
</section>
</div>
</section>
</div>
<div id="code_injection">
<section id="section-4.5">
        <h3 id="name-authorization-code-injectio">
<a href="#section-4.5" class="section-number selfRef">4.5. </a><a href="#name-authorization-code-injectio" class="section-name selfRef">Authorization Code Injection</a>
        </h3>
<p id="section-4.5-1">In an authorization code injection attack, the attacker attempts to
inject a stolen authorization code into the attacker's own session
with the client. The aim is to associate the attacker's session at the
client with the victim's resources or identity.<a href="#section-4.5-1" class="pilcrow">¶</a></p>
<p id="section-4.5-2">This attack is useful if the attacker cannot exchange the
authorization code for an access token himself. Examples include:<a href="#section-4.5-2" class="pilcrow">¶</a></p>
<ul>
<li id="section-4.5-3.1">
            <p id="section-4.5-3.1.1">The code is bound to a particular confidential client and the
attacker is unable to obtain the required client credentials to
redeem the code himself.<a href="#section-4.5-3.1.1" class="pilcrow">¶</a></p>
</li>
<li id="section-4.5-3.2">
            <p id="section-4.5-3.2.1">The attacker wants to access certain functions in this particular
client. As an example, the attacker wants to impersonate his
victim in a certain app or on a certain web site.<a href="#section-4.5-3.2.1" class="pilcrow">¶</a></p>
</li>
<li id="section-4.5-3.3">
            <p id="section-4.5-3.3.1">The authorization or resource servers are limited to certain
networks that the attacker is unable to access directly.<a href="#section-4.5-3.3.1" class="pilcrow">¶</a></p>
</li>
</ul>
<p id="section-4.5-4">In the following attack description and discussion, we assume the
presence of a web (A1) or network attacker (A2).<a href="#section-4.5-4" class="pilcrow">¶</a></p>
<div id="attack-description-1">
<section id="section-4.5.1">
          <h4 id="name-attack-description-2">
<a href="#section-4.5.1" class="section-number selfRef">4.5.1. </a><a href="#name-attack-description-2" class="section-name selfRef">Attack Description</a>
          </h4>
<p id="section-4.5.1-1">The attack works as follows:<a href="#section-4.5.1-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.5.1-2">
            <li id="section-4.5.1-2.1">
              <p id="section-4.5.1-2.1.1">The attacker obtains an authorization code by performing any of
the attacks described above.<a href="#section-4.5.1-2.1.1" class="pilcrow">¶</a></p>
</li>
<li id="section-4.5.1-2.2">
              <p id="section-4.5.1-2.2.1">He performs a regular OAuth authorization process with the
legitimate client on his device.<a href="#section-4.5.1-2.2.1" class="pilcrow">¶</a></p>
</li>
<li id="section-4.5.1-2.3">
              <p id="section-4.5.1-2.3.1">The attacker injects the stolen authorization code in the response
of the authorization server to the legitimate client. Since this
response is passing through the attacker's device, the attacker
can use any tool that can intercept and manipulate the
authorization response to this end. The attacker does not need to
control the network.<a href="#section-4.5.1-2.3.1" class="pilcrow">¶</a></p>
</li>
<li id="section-4.5.1-2.4">
              <p id="section-4.5.1-2.4.1">The legitimate client sends the code to the authorization server's
token endpoint, along with the client's client ID, client secret
and actual <code>redirect_uri</code>.<a href="#section-4.5.1-2.4.1" class="pilcrow">¶</a></p>
</li>
<li id="section-4.5.1-2.5">
              <p id="section-4.5.1-2.5.1">The authorization server checks the client secret, whether the
code was issued to the particular client, and whether the actual
redirect URI matches the <code>redirect_uri</code> parameter (see
<span>[<a href="#RFC6749" class="xref">RFC6749</a>]</span>).<a href="#section-4.5.1-2.5.1" class="pilcrow">¶</a></p>
</li>
<li id="section-4.5.1-2.6">
              <p id="section-4.5.1-2.6.1">All checks succeed and the authorization server issues access and
other tokens to the client. The attacker has now associated his
session with the legitimate client with the victim's resources
and/or identity.<a href="#section-4.5.1-2.6.1" class="pilcrow">¶</a></p>
</li>
</ol>
</section>
</div>
<div id="discussion">
<section id="section-4.5.2">
          <h4 id="name-discussion">
<a href="#section-4.5.2" class="section-number selfRef">4.5.2. </a><a href="#name-discussion" class="section-name selfRef">Discussion</a>
          </h4>
<p id="section-4.5.2-1">Obviously, the check in step (5.) will fail if the code was issued to
another client ID, e.g., a client set up by the attacker. The check
will also fail if the authorization code was already redeemed by the
legitimate user and was one-time use only.<a href="#section-4.5.2-1" class="pilcrow">¶</a></p>
<p id="section-4.5.2-2">An attempt to inject a code obtained via a manipulated redirect URI
should also be detected if the authorization server stored the
complete redirect URI used in the authorization request and compares
it with the <code>redirect_uri</code> parameter.<a href="#section-4.5.2-2" class="pilcrow">¶</a></p>
<p id="section-4.5.2-3"><span>[<a href="#RFC6749" class="xref">RFC6749</a>]</span>, Section 4.1.3, requires the AS to "... ensure that the
<code>redirect_uri</code> parameter is present if the <code>redirect_uri</code> parameter
was included in the initial authorization request as described in
Section 4.1.1, and if included ensure that their values are
identical.". In the attack scenario described above, the legitimate
client would use the correct redirect URI it always uses for
authorization requests. But this URI would not match the tampered
redirect URI used by the attacker (otherwise, the redirect would not
land at the attackers page). So the authorization server would detect
the attack and refuse to exchange the code.<a href="#section-4.5.2-3" class="pilcrow">¶</a></p>
<p id="section-4.5.2-4">Note: this check could also detect attempts to inject an authorization
code which had been obtained from another instance of the same client
on another device, if certain conditions are fulfilled:<a href="#section-4.5.2-4" class="pilcrow">¶</a></p>
<ul>
<li id="section-4.5.2-5.1">
              <p id="section-4.5.2-5.1.1">the redirect URI itself needs to contain a nonce or another kind
of one-time use, secret data and<a href="#section-4.5.2-5.1.1" class="pilcrow">¶</a></p>
</li>
<li id="section-4.5.2-5.2">
              <p id="section-4.5.2-5.2.1">the client has bound this data to this particular instance of the
client.<a href="#section-4.5.2-5.2.1" class="pilcrow">¶</a></p>
</li>
</ul>
<p id="section-4.5.2-6">But this approach conflicts with the idea to enforce exact redirect
URI matching at the authorization endpoint. Moreover, it has been
observed that providers very often ignore the <code>redirect_uri</code> check
requirement at this stage, maybe because it doesn't seem to be
security-critical from reading the specification.<a href="#section-4.5.2-6" class="pilcrow">¶</a></p>
<p id="section-4.5.2-7">Other providers just pattern match the <code>redirect_uri</code> parameter
against the registered redirect URI pattern. This saves the
authorization server from storing the link between the actual redirect
URI and the respective authorization code for every transaction. But
this kind of check obviously does not fulfill the intent of the
specification, since the tampered redirect URI is not considered. So
any attempt to inject an authorization code obtained using the
<code>client_id</code> of a legitimate client or by utilizing the legitimate
client on another device will not be detected in the respective
deployments.<a href="#section-4.5.2-7" class="pilcrow">¶</a></p>
<p id="section-4.5.2-8">It is also assumed that the requirements defined in <span>[<a href="#RFC6749" class="xref">RFC6749</a>]</span>,
Section 4.1.3, increase client implementation complexity as clients
need to store or re-construct the correct redirect URI for the call
to the token endpoint.<a href="#section-4.5.2-8" class="pilcrow">¶</a></p>
<p id="section-4.5.2-9">This document therefore recommends to instead bind every authorization
code to a certain client instance on a certain device (or in a certain
user agent) in the context of a certain transaction using one of the
mechanisms described next.<a href="#section-4.5.2-9" class="pilcrow">¶</a></p>
</section>
</div>
<div id="countermeasures-3">
<section id="section-4.5.3">
          <h4 id="name-countermeasures-4">
<a href="#section-4.5.3" class="section-number selfRef">4.5.3. </a><a href="#name-countermeasures-4" class="section-name selfRef">Countermeasures</a>
          </h4>
<p id="section-4.5.3-1">There are two good technical solutions to achieve this goal:<a href="#section-4.5.3-1" class="pilcrow">¶</a></p>
<ul>
<li id="section-4.5.3-2.1">
              <p id="section-4.5.3-2.1.1"><strong>PKCE</strong>: The PKCE parameter <code>code_challenge</code> along with the
corresponding <code>code_verifier</code> as specified in <span>[<a href="#RFC7636" class="xref">RFC7636</a>]</span> can be
used as a countermeasure. In contrast to its original intention,
the verifier check fails although the client uses its correct
verifier but the code is associated with a challenge that does not
match. PKCE is a deployed OAuth feature, although its original
intended use was solely focused on securing native apps, not the
broader use recommended by this document.<a href="#section-4.5.3-2.1.1" class="pilcrow">¶</a></p>
</li>
<li id="section-4.5.3-2.2">
              <p id="section-4.5.3-2.2.1"><strong>Nonce</strong>: OpenID Connect's existing <code>nonce</code> parameter can be used
for the same purpose. The <code>nonce</code> value is one-time use and
created by the client. The client is supposed to bind it to the
user agent session and sends it with the initial request to the
OpenID Provider (OP). The OP binds <code>nonce</code> to the authorization
code and attests this binding in the ID Token, which is issued as
part of the code exchange at the token endpoint. If an attacker
injected an authorization code in the authorization response, the
nonce value in the client session and the nonce value in the ID
token will not match and the attack is detected. The assumption is
that an attacker cannot get hold of the user agent state on the
victim's device, where he has stolen the respective authorization
code.<a href="#section-4.5.3-2.2.1" class="pilcrow">¶</a></p>
</li>
</ul>
<p id="section-4.5.3-3">Other solutions, like binding <code>state</code> to the code, using token binding
for the code, or per-instance client credentials are conceivable, but
lack support and bring new security requirements.<a href="#section-4.5.3-3" class="pilcrow">¶</a></p>
<p id="section-4.5.3-4">PKCE is the most obvious solution for OAuth clients as it is available
today (originally intended for OAuth native apps) whereas <code>nonce</code> is
appropriate for OpenID Connect clients.<a href="#section-4.5.3-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="limitations">
<section id="section-4.5.4">
          <h4 id="name-limitations">
<a href="#section-4.5.4" class="section-number selfRef">4.5.4. </a><a href="#name-limitations" class="section-name selfRef">Limitations</a>
          </h4>
<p id="section-4.5.4-1">An attacker can circumvent the countermeasures described above if he
can modify the <code>nonce</code> or <code>code_challenge</code> values that are used in the
victim's authorization request. The attacker can modify these values
to be the same ones as those chosen by the client in his own session
in Step 2 of the attack above. (This requires that the victim's
session with the client begins after the attacker started his session
with the client.) If the attacker is then able to capture the
authorization code from the victim, the attacker will be able to
inject the stolen code in Step 3 even if PKCE or <code>nonce</code> are used.<a href="#section-4.5.4-1" class="pilcrow">¶</a></p>
<p id="section-4.5.4-2">This attack is complex and requires a close interaction between the
attacker and the victim's session. Nonetheless, measures to prevent
attackers from reading the contents of the authorization response
still need to be taken, as described in
<a href="#insufficient_uri_validation" class="xref">Section 4.1</a>, <a href="#credential_leakage_referrer" class="xref">Section 4.2</a>,
<a href="#browser_history" class="xref">Section 4.3</a>, <a href="#mix_up" class="xref">Section 4.4</a>, and <a href="#open_redirection" class="xref">Section 4.9</a>.<a href="#section-4.5.4-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="access_token_injection">
<section id="section-4.6">
        <h3 id="name-access-token-injection">
<a href="#section-4.6" class="section-number selfRef">4.6. </a><a href="#name-access-token-injection" class="section-name selfRef">Access Token Injection</a>
        </h3>
<p id="section-4.6-1">In an access token injection attack, the attacker attempts to inject a
stolen access token into a legitimate client (that is not under the
attacker's control). This will typically happen if the attacker wants
to utilize a leaked access token to impersonate a user in a certain
client.<a href="#section-4.6-1" class="pilcrow">¶</a></p>
<p id="section-4.6-2">To conduct the attack, the attacker starts an OAuth flow with the
client using the implicit grant and modifies the authorization
response by replacing the access token issued by the authorization
server or directly makes up an authorization server response including
the leaked access token. Since the response includes the <code>state</code> value
generated by the client for this particular transaction, the client
does not treat the response as a CSRF attack and uses the access token
injected by the attacker.<a href="#section-4.6-2" class="pilcrow">¶</a></p>
<div id="countermeasures-4">
<section id="section-4.6.1">
          <h4 id="name-countermeasures-5">
<a href="#section-4.6.1" class="section-number selfRef">4.6.1. </a><a href="#name-countermeasures-5" class="section-name selfRef">Countermeasures</a>
          </h4>
<p id="section-4.6.1-1">There is no way to detect such an injection attack on the OAuth
protocol level, since the token is issued without any binding to the
transaction or the particular user agent.<a href="#section-4.6.1-1" class="pilcrow">¶</a></p>
<p id="section-4.6.1-2">The recommendation is therefore to use the authorization code grant
type instead of relying on response types issuing acess tokens at the
authorization endpoint. Authorization code injection can be detected
using one of the countermeasures discussed in <a href="#code_injection" class="xref">Section 4.5</a>.<a href="#section-4.6.1-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="cross-site-request-forgery">
<section id="section-4.7">
        <h3 id="name-cross-site-request-forgery">
<a href="#section-4.7" class="section-number selfRef">4.7. </a><a href="#name-cross-site-request-forgery" class="section-name selfRef">Cross Site Request Forgery</a>
        </h3>
<p id="section-4.7-1">An attacker might attempt to inject a request to the redirect URI of
the legitimate client on the victim's device, e.g., to cause the
client to access resources under the attacker's control. This is a
variant of an attack known as Cross-Site Request Forgery (CSRF).<a href="#section-4.7-1" class="pilcrow">¶</a></p>
<div id="csrf_countermeasures">
<section id="section-4.7.1">
          <h4 id="name-countermeasures-6">
<a href="#section-4.7.1" class="section-number selfRef">4.7.1. </a><a href="#name-countermeasures-6" class="section-name selfRef">Countermeasures</a>
          </h4>
<p id="section-4.7.1-1">The traditional countermeasure are CSRF tokens that are bound to the
user agent and passed in the <code>state</code> parameter to the authorization
server as described in <span>[<a href="#RFC6819" class="xref">RFC6819</a>]</span>. Alternatively, PKCE or the OpenID
Connect <code>nonce</code> value provide CSRF protection.<a href="#section-4.7.1-1" class="pilcrow">¶</a></p>
<p id="section-4.7.1-2">When using PKCE instead of <code>state</code> for CSRF protection, it is
important to note that:<a href="#section-4.7.1-2" class="pilcrow">¶</a></p>
<ul>
<li id="section-4.7.1-3.1">
              <p id="section-4.7.1-3.1.1">Clients MUST ensure that the AS supports PKCE before using PKCE for
CSRF protection. If an authorization server does not support PKCE,
<code>state</code> or <code>nonce</code> MUST be used for CSRF protection.<a href="#section-4.7.1-3.1.1" class="pilcrow">¶</a></p>
</li>
<li id="section-4.7.1-3.2">
              <p id="section-4.7.1-3.2.1">If <code>state</code> is used for carrying application state, and integrity of
its contents is a concern, clients MUST protect <code>state</code> against
tampering and swapping. This can be achieved by binding the
contents of state to the browser session and/or signed/encrypted
state values <span>[<a href="#I-D.bradley-oauth-jwt-encoded-state" class="xref">I-D.bradley-oauth-jwt-encoded-state</a>]</span>.<a href="#section-4.7.1-3.2.1" class="pilcrow">¶</a></p>
</li>
</ul>
<p id="section-4.7.1-4">AS therefore MUST provide a way to detect their support for PKCE
either via AS metadata according to <span>[<a href="#RFC8414" class="xref">RFC8414</a>]</span> or provide a
deployment-specific way to ensure or determine PKCE support.<a href="#section-4.7.1-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="access-token-leakage-at-the-resource-server">
<section id="section-4.8">
        <h3 id="name-access-token-leakage-at-the">
<a href="#section-4.8" class="section-number selfRef">4.8. </a><a href="#name-access-token-leakage-at-the" class="section-name selfRef">Access Token Leakage at the Resource Server</a>
        </h3>
<p id="section-4.8-1">Access tokens can leak from a resource server under certain
circumstances.<a href="#section-4.8-1" class="pilcrow">¶</a></p>
<div id="access-token-phishing-by-counterfeit-resource-server">
<section id="section-4.8.1">
          <h4 id="name-access-token-phishing-by-co">
<a href="#section-4.8.1" class="section-number selfRef">4.8.1. </a><a href="#name-access-token-phishing-by-co" class="section-name selfRef">Access Token Phishing by Counterfeit Resource Server</a>
          </h4>
<p id="section-4.8.1-1">An attacker may setup his own resource server and trick a client into
sending access tokens to it that are valid for other resource servers
(see Attackers A1 and A5). If the client sends a valid access token to
this counterfeit resource server, the attacker in turn may use that
token to access other services on behalf of the resource owner.<a href="#section-4.8.1-1" class="pilcrow">¶</a></p>
<p id="section-4.8.1-2">This attack assumes the client is not bound to one specific resource
server (and its URL) at development time, but client instances are
provided with the resource server URL at runtime. This kind of late
binding is typical in situations where the client uses a service
implementing a standardized API (e.g., for e-Mail, calendar, health,
or banking) and where the client is configured by a user or
administrator for a service which this user or company uses.<a href="#section-4.8.1-2" class="pilcrow">¶</a></p>
<div id="countermeasures-5">
<section id="section-4.8.1.1">
            <h5 id="name-countermeasures-7">
<a href="#section-4.8.1.1" class="section-number selfRef">4.8.1.1. </a><a href="#name-countermeasures-7" class="section-name selfRef">Countermeasures</a>
            </h5>
<p id="section-4.8.1.1-1">There are several potential mitigation strategies, which will be
discussed in the following sections.<a href="#section-4.8.1.1-1" class="pilcrow">¶</a></p>
<div id="metadata">
<section id="section-4.8.1.1.1">
              <h6 id="name-metadata">
<a href="#section-4.8.1.1.1" class="section-number selfRef">4.8.1.1.1. </a><a href="#name-metadata" class="section-name selfRef">Metadata</a>
              </h6>
<p id="section-4.8.1.1.1-1">An authorization server could provide the client with additional
information about the location where it is safe to use its access
tokens.<a href="#section-4.8.1.1.1-1" class="pilcrow">¶</a></p>
<p id="section-4.8.1.1.1-2">In the simplest form, this would require the AS to publish a list of
its known resource servers, illustrated in the following example using
a non-standard metadata parameter <code>resource_servers</code>:<a href="#section-4.8.1.1.1-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.8.1.1.1-3">
<pre>HTTP/1.1 200 OK
Content-Type: application/json

{
  "issuer":"https://server.somesite.example",
  "authorization_endpoint":
    "https://server.somesite.example/authorize",
  "resource_servers":[
    "email.somesite.example",
    "storage.somesite.example",
    "video.somesite.example"
  ]
  ...
}
</pre><a href="#section-4.8.1.1.1-3" class="pilcrow">¶</a>
</div>
<p id="section-4.8.1.1.1-4">The AS could also return the URL(s) an access token is good for in the
token response, illustrated by the example and non-standard return
parameter <code>access_token_resource_server</code>:<a href="#section-4.8.1.1.1-4" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.8.1.1.1-5">
<pre>HTTP/1.1 200 OK
Content-Type: application/json;charset=UTF-8
Cache-Control: no-store
Pragma: no-cache

{
  "access_token":"2YotnFZFEjr1zCsicMWpAA",
  "access_token_resource_server":
    "https://hostedresource.somesite.example/path1",
...
}
</pre><a href="#section-4.8.1.1.1-5" class="pilcrow">¶</a>
</div>
<p id="section-4.8.1.1.1-6">This mitigation strategy would rely on the client to enforce the
security policy and to only send access tokens to legitimate
destinations. Results of OAuth related security research (see for
example <span>[<a href="#oauth_security_ubc" class="xref">oauth_security_ubc</a>]</span> and <span>[<a href="#oauth_security_cmu" class="xref">oauth_security_cmu</a>]</span>) indicate a
large portion of client implementations do not or fail to properly
implement security controls, like <code>state</code> checks. So relying on
clients to prevent access token phishing is likely to fail as well.
Moreover given the ratio of clients to authorization and resource
servers, it is considered the more viable approach to move as much as
possible security-related logic to those entities. Clearly, the client
has to contribute to the overall security. But there are alternative
countermeasures, as described in the next sections, which provide a
better balance between the involved parties.<a href="#section-4.8.1.1.1-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="pop_tokens">
<section id="section-4.8.1.1.2">
              <h6 id="name-sender-constrained-access-t">
<a href="#section-4.8.1.1.2" class="section-number selfRef">4.8.1.1.2. </a><a href="#name-sender-constrained-access-t" class="section-name selfRef">Sender-Constrained Access Tokens</a>
              </h6>
<p id="section-4.8.1.1.2-1">As the name suggests, sender-constrained access token scope the
applicability of an access token to a certain sender. This sender is
obliged to demonstrate knowledge of a certain secret as prerequisite
for the acceptance of that token at a resource server.<a href="#section-4.8.1.1.2-1" class="pilcrow">¶</a></p>
<p id="section-4.8.1.1.2-2">A typical flow looks like this:<a href="#section-4.8.1.1.2-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.8.1.1.2-3">
                <li id="section-4.8.1.1.2-3.1">
                  <p id="section-4.8.1.1.2-3.1.1">The authorization server associates data with the access token
that binds this particular token to a certain client. The binding
can utilize the client identity, but in most cases the AS utilizes
key material (or data derived from the key material) known to the
client.<a href="#section-4.8.1.1.2-3.1.1" class="pilcrow">¶</a></p>
</li>
<li id="section-4.8.1.1.2-3.2">
                  <p id="section-4.8.1.1.2-3.2.1">This key material must be distributed somehow. Either the key
material already exists before the AS creates the binding or the
AS creates ephemeral keys. The way pre-existing key material is
distributed varies among the different approaches. For example,
X.509 Certificates can be used in which case the distribution
happens explicitly during the enrollment process. Or the key
material is created and distributed at the TLS layer, in which
case it might automatically happen during the setup of a TLS
connection.<a href="#section-4.8.1.1.2-3.2.1" class="pilcrow">¶</a></p>
</li>
<li id="section-4.8.1.1.2-3.3">
                  <p id="section-4.8.1.1.2-3.3.1">The RS must implement the actual proof of possession check. This
is typically done on the application level, often tied to specific
material provided by transport layer (e.g., TLS). The RS must also
ensure that replay of the proof of possession is not possible.<a href="#section-4.8.1.1.2-3.3.1" class="pilcrow">¶</a></p>
</li>
</ol>
<p id="section-4.8.1.1.2-4">There exist several proposals to demonstrate the proof of possession
 in the scope of the OAuth working group:<a href="#section-4.8.1.1.2-4" class="pilcrow">¶</a></p>
<ul>
<li id="section-4.8.1.1.2-5.1">
                  <p id="section-4.8.1.1.2-5.1.1"><strong>OAuth Mutual TLS</strong> (<span>[<a href="#I-D.ietf-oauth-mtls" class="xref">I-D.ietf-oauth-mtls</a>]</span>): The approach as
specified in this document allows the use of mutual TLS (mTLS) for both
client authentication and sender-constrained access tokens. For
the purpose of sender-constrained access tokens, the client is
identified towards the resource server by the fingerprint of its
public key. During processing of an access token request, the
authorization server obtains the client's public key from the TLS
stack and associates its fingerprint with the respective access
tokens. The resource server in the same way obtains the public key
from the TLS stack and compares its fingerprint with the
fingerprint associated with the access token.<a href="#section-4.8.1.1.2-5.1.1" class="pilcrow">¶</a></p>
</li>
<li id="section-4.8.1.1.2-5.2">
                  <p id="section-4.8.1.1.2-5.2.1"><strong>DPoP</strong> (<span>[<a href="#I-D.fett-oauth-dpop" class="xref">I-D.fett-oauth-dpop</a>]</span>): DPoP (Demonstration of
Proof-of-Possession at the Application Layer) outlines an
application-level sender-constraining for access and refresh
tokens that can be used in cases where neither mTLS nor OAuth
Token Binding (see below) are available. It uses
proof-of-possession based on a public/private key pair and
application-level signing. DPoP can be used with public clients
and, in case of confidential clients, can be combined with any
client authentication method.<a href="#section-4.8.1.1.2-5.2.1" class="pilcrow">¶</a></p>
</li>
<li id="section-4.8.1.1.2-5.3">
                  <p id="section-4.8.1.1.2-5.3.1"><strong>OAuth Token Binding</strong> (<span>[<a href="#I-D.ietf-oauth-token-binding" class="xref">I-D.ietf-oauth-token-binding</a>]</span>): In this approach, an access
token is, via the token binding ID, bound to key
material representing a long term association between a client and
a certain TLS host. Negotiation of the key material and proof of
possession in the context of a TLS handshake is taken care of by
the TLS stack. The client needs to determine the token binding ID
of the target resource server and pass this data to the access
token request. The authorization server then associates the access
token with this ID. The resource server checks on every invocation
that the token binding ID of the active TLS connection and the
token binding ID of associated with the access token match. Since
all crypto-related functions are covered by the TLS stack, this
approach is very client developer friendly. As a prerequisite,
token binding as described in <span>[<a href="#RFC8473" class="xref">RFC8473</a>]</span>
(including federated token bindings) must be supported on all ends
(client, authorization server, resource server).<a href="#section-4.8.1.1.2-5.3.1" class="pilcrow">¶</a></p>
</li>
<li id="section-4.8.1.1.2-5.4">
                  <p id="section-4.8.1.1.2-5.4.1"><strong>Signed HTTP Requests</strong> (<span>[<a href="#I-D.ietf-oauth-signed-http-request" class="xref">I-D.ietf-oauth-signed-http-request</a>]</span>):
This approach utilizes <span>[<a href="#I-D.ietf-oauth-pop-key-distribution" class="xref">I-D.ietf-oauth-pop-key-distribution</a>]</span> and
represents the elements of the signature in a JSON object. The
signature is built using JWS. The mechanism has built-in support
for signing of HTTP method, query parameters and headers. It also
incorporates a timestamp as basis for replay prevention.<a href="#section-4.8.1.1.2-5.4.1" class="pilcrow">¶</a></p>
</li>
<li id="section-4.8.1.1.2-5.5">
                  <p id="section-4.8.1.1.2-5.5.1"><strong>JWT Pop Tokens</strong> (<span>[<a href="#I-D.sakimura-oauth-jpop" class="xref">I-D.sakimura-oauth-jpop</a>]</span>): This draft
describes different ways to constrain access token usage, namely
TLS or request signing. Note: Since the authors of this draft
contributed the TLS-related proposal to <span>[<a href="#I-D.ietf-oauth-mtls" class="xref">I-D.ietf-oauth-mtls</a>]</span>,
this document only considers the request signing part. For request
signing, the draft utilizes
<span>[<a href="#I-D.ietf-oauth-pop-key-distribution" class="xref">I-D.ietf-oauth-pop-key-distribution</a>]</span> and <span>[<a href="#RFC7800" class="xref">RFC7800</a>]</span>. The
signature data is represented in a JWT and JWS is used for
signing. Replay prevention is provided by building the signature
over a server-provided nonce, client-provided nonce and a nonce
counter.<a href="#section-4.8.1.1.2-5.5.1" class="pilcrow">¶</a></p>
</li>
</ul>
<p id="section-4.8.1.1.2-6">OAuth Mutual TLS and OAuth Token Binding are built
on top of TLS and this way continue the successful OAuth
philosophy to leverage TLS to secure OAuth wherever possible. Both
mechanisms allow prevention of access token leakage in a fairly client
developer friendly way.<a href="#section-4.8.1.1.2-6" class="pilcrow">¶</a></p>
<p id="section-4.8.1.1.2-7">There are some differences between both approaches: To start with, for
OAuth Token Binding, all key material is automatically managed by the
TLS stack whereas mTLS requires the developer to create and maintain
the key pairs and respective certificates. Use of self-signed
certificates, which is supported by the draft, significantly reduces
the complexity of this task. Furthermore, OAuth Token Binding allows
to use different key pairs for different resource servers, which is a
privacy benefit. On the other hand, <span>[<a href="#I-D.ietf-oauth-mtls" class="xref">I-D.ietf-oauth-mtls</a>]</span> only
requires widely deployed TLS features, which means it might be easier
to adopt in the short term.<a href="#section-4.8.1.1.2-7" class="pilcrow">¶</a></p>
<p id="section-4.8.1.1.2-8">Application level signing approaches, like
<span>[<a href="#I-D.ietf-oauth-signed-http-request" class="xref">I-D.ietf-oauth-signed-http-request</a>]</span> and <span>[<a href="#I-D.sakimura-oauth-jpop" class="xref">I-D.sakimura-oauth-jpop</a>]</span>
have been debated for a long time in the OAuth working group without a
clear outcome.<a href="#section-4.8.1.1.2-8" class="pilcrow">¶</a></p>
<p id="section-4.8.1.1.2-9">As one advantage, application-level signing allows for end-to-end
protection including non-repudiation even if the TLS connection is
terminated between client and resource server. But deployment
experiences have revealed challenges regarding robustness (e.g.,
reproduction of the signature base string including correct URL) as
well as state management (e.g., replay prevention).<a href="#section-4.8.1.1.2-9" class="pilcrow">¶</a></p>
<p id="section-4.8.1.1.2-10">This document therefore recommends implementers to consider one of the
TLS-based approaches wherever possible.<a href="#section-4.8.1.1.2-10" class="pilcrow">¶</a></p>
<p id="section-4.8.1.1.2-11">Note that the security of sender-constrained tokens is undermined when
an attacker gets access to the token and the key material. This is in
particular the case for corrupted client software and cross-site
scripting attacks (when the client is running in the browser). If the
key material is protected in a hardware or software security module or
only indirectly accessible (like in a TLS stack), sender-constrained
tokens at least protect against a use of the token when the client is
offline, i.e., when the security module or interface is not available
to the attacker. This applies to access tokens as well as to refresh
tokens (see <a href="#refresh_token_protection" class="xref">Section 4.12</a>).<a href="#section-4.8.1.1.2-11" class="pilcrow">¶</a></p>
</section>
</div>
<div id="aud_restriction">
<section id="section-4.8.1.1.3">
              <h6 id="name-audience-restricted-access-">
<a href="#section-4.8.1.1.3" class="section-number selfRef">4.8.1.1.3. </a><a href="#name-audience-restricted-access-" class="section-name selfRef">Audience Restricted Access Tokens</a>
              </h6>
<p id="section-4.8.1.1.3-1">Audience restriction essentially restricts access tokens to a
particular resource server. The authorization server associates the
access token with the particular resource server and the resource
server SHOULD verify the intended audience. If the access token fails
the intended audience validation, the resource server must refuse to
serve the respective request.<a href="#section-4.8.1.1.3-1" class="pilcrow">¶</a></p>
<p id="section-4.8.1.1.3-2">In general, audience restrictions limit the impact of token leakage.
In the case of a counterfeit resource server, it may (as described
below) also prevent abuse of the phished access token at the
legitimate resource server.<a href="#section-4.8.1.1.3-2" class="pilcrow">¶</a></p>
<p id="section-4.8.1.1.3-3">The audience can be expressed using logical names or
physical addresses (like URLs). In order to prevent phishing, it is
necessary to use the actual URL the client will send requests to. In
the phishing case, this URL will point to the counterfeit resource
server. If the attacker tries to use the access token at the
legitimate resource server (which has a different URL), the resource
server will detect the mismatch (wrong audience) and refuse to serve
the request.<a href="#section-4.8.1.1.3-3" class="pilcrow">¶</a></p>
<p id="section-4.8.1.1.3-4">In deployments where the authorization server knows the URLs of all
resource servers, the authorization server may just refuse to issue
access tokens for unknown resource server URLs.<a href="#section-4.8.1.1.3-4" class="pilcrow">¶</a></p>
<p id="section-4.8.1.1.3-5">The client SHOULD tell the authorization server the intended
resource server. The proposed mechanism
<span>[<a href="#I-D.ietf-oauth-resource-indicators" class="xref">I-D.ietf-oauth-resource-indicators</a>]</span> could be used or by encoding the
information in the scope value.<a href="#section-4.8.1.1.3-5" class="pilcrow">¶</a></p>
<p id="section-4.8.1.1.3-6">Instead of the URL, it is also possible to utilize the fingerprint of
the resource server's X.509 certificate as audience value. This
variant would also allow to detect an attempt to spoof the legitimate
resource server's URL by using a valid TLS certificate obtained from a
different CA. It might also be considered a privacy benefit to hide
the resource server URL from the authorization server.<a href="#section-4.8.1.1.3-6" class="pilcrow">¶</a></p>
<p id="section-4.8.1.1.3-7">Audience restriction may seem easier to use since it does not require
any crypto on the client-side. Still, since every access token is
bound to a specific resource server, the client also needs to obtain a
single RS-specific access token when accessing several resource
servers. (Resource indicators, as specified in
<span>[<a href="#I-D.ietf-oauth-resource-indicators" class="xref">I-D.ietf-oauth-resource-indicators</a>]</span>, can help to achieve this.)
<span>[<a href="#I-D.ietf-oauth-token-binding" class="xref">I-D.ietf-oauth-token-binding</a>]</span> has the same property since different
token binding ids must be associated with the access token. Using
<span>[<a href="#I-D.ietf-oauth-mtls" class="xref">I-D.ietf-oauth-mtls</a>]</span>, on the other hand, allows a client to use the
access token at multiple resource servers.<a href="#section-4.8.1.1.3-7" class="pilcrow">¶</a></p>
<p id="section-4.8.1.1.3-8">It shall be noted that audience restrictions, or generally speaking an
indication by the client to the authorization server where it wants to
use the access token, has additional benefits beyond the scope of
token leakage prevention. It allows the authorization server to create
different access token whose format and content is specifically minted
for the respective server. This has huge functional and privacy
advantages in deployments using structured access tokens.<a href="#section-4.8.1.1.3-8" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="comp_res_server">
<section id="section-4.8.2">
          <h4 id="name-compromised-resource-server">
<a href="#section-4.8.2" class="section-number selfRef">4.8.2. </a><a href="#name-compromised-resource-server" class="section-name selfRef">Compromised Resource Server</a>
          </h4>
<p id="section-4.8.2-1">An attacker may compromise a resource server to gain access to the
resources of the respective deployment. Such a compromise may range
from partial access to the system, e.g., its log files, to full
control of the respective server.<a href="#section-4.8.2-1" class="pilcrow">¶</a></p>
<p id="section-4.8.2-2">If the attacker were able to gain full control, including shell
access, all controls can be circumvented and all resources be
accessed. The attacker would also be able to obtain other access
tokens held on the compromised system that would potentially be valid
to access other resource servers.<a href="#section-4.8.2-2" class="pilcrow">¶</a></p>
<p id="section-4.8.2-3">Preventing server breaches by hardening and monitoring server systems
is considered a standard operational procedure and, therefore, out of
the scope of this document. This section focuses on the impact of
OAuth-related breaches and the replaying of captured access tokens.<a href="#section-4.8.2-3" class="pilcrow">¶</a></p>
<p id="section-4.8.2-4">The following measures should be taken into account by implementers in
order to cope with access token replay by malicious actors:<a href="#section-4.8.2-4" class="pilcrow">¶</a></p>
<ul>
<li id="section-4.8.2-5.1">
              <p id="section-4.8.2-5.1.1">Sender-constrained access tokens as described in <a href="#pop_tokens" class="xref">Section 4.8.1.1.2</a>
SHOULD be used to prevent the attacker from replaying the access
tokens on other resource servers. Depending on the severity of the
penetration, sender-constrained access tokens will also prevent
replay on the compromised system.<a href="#section-4.8.2-5.1.1" class="pilcrow">¶</a></p>
</li>
<li id="section-4.8.2-5.2">
              <p id="section-4.8.2-5.2.1">Audience restriction as described in <a href="#aud_restriction" class="xref">Section 4.8.1.1.3</a> SHOULD be
used to prevent replay of captured access tokens on other resource
servers.<a href="#section-4.8.2-5.2.1" class="pilcrow">¶</a></p>
</li>
<li id="section-4.8.2-5.3">
              <p id="section-4.8.2-5.3.1">The resource server MUST treat access tokens like any other
credentials. It is considered good practice to not log them and
not store them in plain text.<a href="#section-4.8.2-5.3.1" class="pilcrow">¶</a></p>
</li>
</ul>
<p id="section-4.8.2-6">The first and second recommendation also apply to other scenarios
where access tokens leak (see Attacker A5).<a href="#section-4.8.2-6" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="open_redirection">
<section id="section-4.9">
        <h3 id="name-open-redirection">
<a href="#section-4.9" class="section-number selfRef">4.9. </a><a href="#name-open-redirection" class="section-name selfRef">Open Redirection</a>
        </h3>
<p id="section-4.9-1">The following attacks can occur when an AS or client has an open
redirector. An open redirector is an endpoint that forwards a user's
browser to an arbitrary URI obtained from a query parameter.<a href="#section-4.9-1" class="pilcrow">¶</a></p>
<div id="open_redirector_on_client">
<section id="section-4.9.1">
          <h4 id="name-client-as-open-redirector">
<a href="#section-4.9.1" class="section-number selfRef">4.9.1. </a><a href="#name-client-as-open-redirector" class="section-name selfRef">Client as Open Redirector</a>
          </h4>
<p id="section-4.9.1-1">Clients MUST NOT expose open redirectors. Attackers may use open
redirectors to produce URLs pointing to the client and utilize them to
exfiltrate authorization codes and access tokens, as described in
<a href="#redir_uri_open_redir" class="xref">Section 4.1.2</a>. Another abuse case is to produce URLs that
appear to point to the client. This might trick users into trusting the URL
and follow it in their browser. This can be abused for phishing.<a href="#section-4.9.1-1" class="pilcrow">¶</a></p>
<p id="section-4.9.1-2">In order to prevent open redirection, clients should only redirect if
the target URLs are whitelisted or if the origin and integrity of a
request can be authenticated. Countermeasures against open redirection
are described by OWASP <span>[<a href="#owasp_redir" class="xref">owasp_redir</a>]</span>.<a href="#section-4.9.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authorization-server-as-open-redirector">
<section id="section-4.9.2">
          <h4 id="name-authorization-server-as-ope">
<a href="#section-4.9.2" class="section-number selfRef">4.9.2. </a><a href="#name-authorization-server-as-ope" class="section-name selfRef">Authorization Server as Open Redirector</a>
          </h4>
<p id="section-4.9.2-1">Just as with clients, attackers could try to utilize a user's trust in
the authorization server (and its URL in particular) for performing
phishing attacks. OAuth authorization servers regularly redirect users
to other web sites (the clients), but must do so in a safe way.<a href="#section-4.9.2-1" class="pilcrow">¶</a></p>
<p id="section-4.9.2-2"><span>[<a href="#RFC6749" class="xref">RFC6749</a>]</span>, Section 4.1.2.1, already prevents open redirects by
stating that the AS MUST NOT automatically redirect the user agent in case
of an invalid combination of <code>client_id</code> and <code>redirect_uri</code>.<a href="#section-4.9.2-2" class="pilcrow">¶</a></p>
<p id="section-4.9.2-3">However, as described in <span>[<a href="#I-D.ietf-oauth-closing-redirectors" class="xref">I-D.ietf-oauth-closing-redirectors</a>]</span>, an
attacker could also utilize a correctly registered redirect URI to
perform phishing attacks. The attacker could, for example, register a
client via dynamic client registration <span>[<a href="#RFC7591" class="xref">RFC7591</a>]</span> and intentionally
send an erroneous authorization request, e.g., by using an invalid
scope value, thus instructing the AS to redirect the user agent to its
phishing site.<a href="#section-4.9.2-3" class="pilcrow">¶</a></p>
<p id="section-4.9.2-4">The AS MUST take precautions to prevent this threat. Based on its risk
assessment, the AS needs to decide whether it can trust the redirect
URI and SHOULD only automatically redirect the user agent if it trusts
the redirect URI. If the URI is not trusted, the AS MAY inform the
user and rely on the user to make the correct decision.<a href="#section-4.9.2-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="redirect_307">
<section id="section-4.10">
        <h3 id="name-307-redirect">
<a href="#section-4.10" class="section-number selfRef">4.10. </a><a href="#name-307-redirect" class="section-name selfRef">307 Redirect</a>
        </h3>
<p id="section-4.10-1">At the authorization endpoint, a typical protocol flow is that the AS
prompts the user to enter her credentials in a form that is then
submitted (using the HTTP POST method) back to the authorization
server. The AS checks the credentials and, if successful, redirects
the user agent to the client's redirection endpoint.<a href="#section-4.10-1" class="pilcrow">¶</a></p>
<p id="section-4.10-2">In <span>[<a href="#RFC6749" class="xref">RFC6749</a>]</span>, the HTTP status code 302 is used for this purpose, but
"any other method available via the user-agent to accomplish this
redirection is allowed". When the status code 307 is used for
redirection instead, the user agent will send the user credentials via
HTTP POST to the client.<a href="#section-4.10-2" class="pilcrow">¶</a></p>
<p id="section-4.10-3">This discloses the sensitive credentials to the client. If the relying
party is malicious, it can use the credentials to impersonate the user
at the AS.<a href="#section-4.10-3" class="pilcrow">¶</a></p>
<p id="section-4.10-4">The behavior might be unexpected for developers, but is defined in
<span>[<a href="#RFC7231" class="xref">RFC7231</a>]</span>, Section 6.4.7. This status code does not require the user
agent to rewrite the POST request to a GET request and thereby drop
the form data in the POST request body.<a href="#section-4.10-4" class="pilcrow">¶</a></p>
<p id="section-4.10-5">In the HTTP standard <span>[<a href="#RFC7231" class="xref">RFC7231</a>]</span>, only the status code 303
unambigiously enforces rewriting the HTTP POST request to an HTTP GET
request. For all other status codes, including the popular 302, user
agents can opt not to rewrite POST to GET requests and therefore to
reveal the user credentials to the client. (In practice, however, most
user agents will only show this behaviour for 307 redirects.)<a href="#section-4.10-5" class="pilcrow">¶</a></p>
<p id="section-4.10-6">AS which redirect a request that potentially contains user credentials
therefore MUST NOT use the HTTP 307 status code for redirection. If an
HTTP redirection (and not, for example, JavaScript) is used for such a
request, AS SHOULD use HTTP status code 303 "See Other".<a href="#section-4.10-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="tls_terminating">
<section id="section-4.11">
        <h3 id="name-tls-terminating-reverse-pro">
<a href="#section-4.11" class="section-number selfRef">4.11. </a><a href="#name-tls-terminating-reverse-pro" class="section-name selfRef">TLS Terminating Reverse Proxies</a>
        </h3>
<p id="section-4.11-1">A common deployment architecture for HTTP applications is to hide the
application server behind a reverse proxy that terminates the TLS
connection and dispatches the incoming requests to the respective
application server nodes.<a href="#section-4.11-1" class="pilcrow">¶</a></p>
<p id="section-4.11-2">This section highlights some attack angles of this deployment
architecture with relevance to OAuth and gives recommendations for
security controls.<a href="#section-4.11-2" class="pilcrow">¶</a></p>
<p id="section-4.11-3">In some situations, the reverse proxy needs to pass security-related
data to the upstream application servers for further processing.
Examples include the IP address of the request originator, token
binding ids, and authenticated TLS client certificates. This data is
usually passed in custom HTTP headers added to the upstream request.<a href="#section-4.11-3" class="pilcrow">¶</a></p>
<p id="section-4.11-4">If the reverse proxy would pass through any header sent from the
outside, an attacker could try to directly send the faked header
values through the proxy to the application server in order to
circumvent security controls that way. For example, it is standard
practice of reverse proxies to accept <code>X-Forwarded-For</code> headers and just
add the origin of the inbound request (making it a list). Depending on
the logic performed in the application server, the attacker could
simply add a whitelisted IP address to the header and render a IP
whitelist useless.<a href="#section-4.11-4" class="pilcrow">¶</a></p>
<p id="section-4.11-5">A reverse proxy must therefore sanitize any inbound requests to ensure
the authenticity and integrity of all header values relevant for the
security of the application servers.<a href="#section-4.11-5" class="pilcrow">¶</a></p>
<p id="section-4.11-6">If an attacker was able to get access to the internal network between
proxy and application server, the attacker could also try to
circumvent security controls in place. It is, therefore, essential to
ensure the authenticity of the communicating entities. Furthermore,
the communication link between reverse proxy and application server
must be protected against eavesdropping, injection, and replay of
messages.<a href="#section-4.11-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="refresh_token_protection">
<section id="section-4.12">
        <h3 id="name-refresh-token-protection">
<a href="#section-4.12" class="section-number selfRef">4.12. </a><a href="#name-refresh-token-protection" class="section-name selfRef">Refresh Token Protection</a>
        </h3>
<p id="section-4.12-1">Refresh tokens are a convenient and user-friendly way to obtain new access
tokens after the expiration of access tokens. Refresh tokens also add
to the security of OAuth since they allow the authorization server to issue
access tokens with a short lifetime and reduced scope thus reducing the
potential impact of access token leakage.<a href="#section-4.12-1" class="pilcrow">¶</a></p>
<div id="discussion-1">
<section id="section-4.12.1">
          <h4 id="name-discussion-2">
<a href="#section-4.12.1" class="section-number selfRef">4.12.1. </a><a href="#name-discussion-2" class="section-name selfRef">Discussion</a>
          </h4>
<p id="section-4.12.1-1">Refresh tokens are an attractive target for attackers since they
represent the overall grant a resource owner delegated to a certain
client. If an attacker is able to exfiltrate and successfully replay a
refresh token, the attacker will be able to mint access tokens and use
them to access resource servers on behalf of the resource owner.<a href="#section-4.12.1-1" class="pilcrow">¶</a></p>
<p id="section-4.12.1-2"><span>[<a href="#RFC6749" class="xref">RFC6749</a>]</span> already provides a robust baseline protection by requiring<a href="#section-4.12.1-2" class="pilcrow">¶</a></p>
<ul>
<li id="section-4.12.1-3.1">
              <p id="section-4.12.1-3.1.1">confidentiality of the refresh tokens in transit and storage,<a href="#section-4.12.1-3.1.1" class="pilcrow">¶</a></p>
</li>
<li id="section-4.12.1-3.2">
              <p id="section-4.12.1-3.2.1">the transmission of refresh tokens over TLS-protected connections between
authorization server and client,<a href="#section-4.12.1-3.2.1" class="pilcrow">¶</a></p>
</li>
<li id="section-4.12.1-3.3">
              <p id="section-4.12.1-3.3.1">the authorization server to maintain and check the binding of a refresh token
to a certain client (i.e., <code>client_id</code>),<a href="#section-4.12.1-3.3.1" class="pilcrow">¶</a></p>
</li>
<li id="section-4.12.1-3.4">
              <p id="section-4.12.1-3.4.1">authentication of this client during token refresh, if possible, and<a href="#section-4.12.1-3.4.1" class="pilcrow">¶</a></p>
</li>
<li id="section-4.12.1-3.5">
              <p id="section-4.12.1-3.5.1">that refresh tokens cannot be generated, modified, or guessed.<a href="#section-4.12.1-3.5.1" class="pilcrow">¶</a></p>
</li>
</ul>
<p id="section-4.12.1-4"><span>[<a href="#RFC6749" class="xref">RFC6749</a>]</span> also lays the foundation for further (implementation
specific) security measures, such as refresh token expiration and
revocation as well as refresh token rotation by defining respective
error codes and response behavior.<a href="#section-4.12.1-4" class="pilcrow">¶</a></p>
<p id="section-4.12.1-5">This specification gives recommendations beyond the scope of
<span>[<a href="#RFC6749" class="xref">RFC6749</a>]</span> and clarifications.<a href="#section-4.12.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="recommendations-1">
<section id="section-4.12.2">
          <h4 id="name-recommendations-2">
<a href="#section-4.12.2" class="section-number selfRef">4.12.2. </a><a href="#name-recommendations-2" class="section-name selfRef">Recommendations</a>
          </h4>
<p id="section-4.12.2-1">Authorization servers SHOULD determine, based on a risk assessment,
whether to issue refresh tokens to a certain client. If the
authorization server decides not to issue refresh tokens, the client
MAY refresh access tokens by utilizing other grant types, such as the
authorization code grant type. In such a case, the authorization
server may utilize cookies and persistent grants to optimize the user
experience.<a href="#section-4.12.2-1" class="pilcrow">¶</a></p>
<p id="section-4.12.2-2">If refresh tokens are issued, those refresh tokens MUST be bound to
the scope and resource servers as consented by the resource owner.
This is to prevent privilege escalation by the legitimate client and reduce
the impact of refresh token leakage.<a href="#section-4.12.2-2" class="pilcrow">¶</a></p>
<p id="section-4.12.2-3">Authorization server MUST utilize one of these methods to
detect refresh token replay by malicious actors for public clients:<a href="#section-4.12.2-3" class="pilcrow">¶</a></p>
<ul>
<li id="section-4.12.2-4.1">
              <p id="section-4.12.2-4.1.1"><strong>Sender-constrained refresh tokens:</strong> the authorization server
cryptographically binds the refresh token to a certain client
instance by utilizing <span>[<a href="#I-D.ietf-oauth-token-binding" class="xref">I-D.ietf-oauth-token-binding</a>]</span> or
<span>[<a href="#I-D.ietf-oauth-mtls" class="xref">I-D.ietf-oauth-mtls</a>]</span>.<a href="#section-4.12.2-4.1.1" class="pilcrow">¶</a></p>
</li>
<li id="section-4.12.2-4.2">
              <p id="section-4.12.2-4.2.1"><strong>Refresh token rotation:</strong> the authorization server issues a new
refresh token with every access token refresh response. The
previous refresh token is invalidated but information about the
relationship is retained by the authorization server. If a refresh
token is compromised and subsequently used by both the attacker
and the legitimate client, one of them will present an invalidated
refresh token, which will inform the authorization server of the
breach. The authorization server cannot determine which party
submitted the invalid refresh token, but it will revoke the
active refresh token. This stops the attack at the cost of forcing
the legitimate client to obtain a fresh authorization grant.<a href="#section-4.12.2-4.2.1" class="pilcrow">¶</a></p>
<p id="section-4.12.2-4.2.2">Implementation note: the grant to which a refresh token belongs
may be encoded into the refresh token itself. This can enable an
authorization server to efficiently determine the grant to which a
refresh token belongs, and by extension, all refresh tokens that
need to be revoked. Authorization servers MUST ensure the
integrity of the refresh token value in this case, for example,
using signatures.<a href="#section-4.12.2-4.2.2" class="pilcrow">¶</a></p>
</li>
</ul>
<p id="section-4.12.2-5">Authorization servers MAY revoke refresh tokens automatically in case
of a security event, such as:<a href="#section-4.12.2-5" class="pilcrow">¶</a></p>
<ul>
<li id="section-4.12.2-6.1">
              <p id="section-4.12.2-6.1.1">password change<a href="#section-4.12.2-6.1.1" class="pilcrow">¶</a></p>
</li>
<li id="section-4.12.2-6.2">
              <p id="section-4.12.2-6.2.1">logout at the authorization server<a href="#section-4.12.2-6.2.1" class="pilcrow">¶</a></p>
</li>
</ul>
<p id="section-4.12.2-7">Refresh tokens SHOULD expire if the client has been inactive for some
time, i.e., the refresh token has not been used to obtain fresh access
tokens for some time. The expiration time is at the discretion of the
authorization server. It might be a global value or determined based
on the client policy or the grant associated with the refresh token
(and its sensitivity).<a href="#section-4.12.2-7" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="client_impersonating">
<section id="section-4.13">
        <h3 id="name-client-impersonating-resour">
<a href="#section-4.13" class="section-number selfRef">4.13. </a><a href="#name-client-impersonating-resour" class="section-name selfRef">Client Impersonating Resource Owner</a>
        </h3>
<p id="section-4.13-1">Resource servers may make access control decisions based on the
identity of the resource owner as communicated in the <code>sub</code> claim
returned by the authorization server in a token introspection response
<span>[<a href="#RFC7662" class="xref">RFC7662</a>]</span> or other mechanisms. If a client is able to choose its own
<code>client_id</code> during registration with the authorization server, then
there is a risk that it can register with the same <code>sub</code> value as a
privileged user. A subsequent access token obtained under the client
credentials grant may be mistaken for an access token authorized by the
privileged user if the resource server does not perform additional
checks.<a href="#section-4.13-1" class="pilcrow">¶</a></p>
<div id="client_impersonating_countermeasures">
<section id="section-4.13.1">
          <h4 id="name-countermeasures-8">
<a href="#section-4.13.1" class="section-number selfRef">4.13.1. </a><a href="#name-countermeasures-8" class="section-name selfRef">Countermeasures</a>
          </h4>
<p id="section-4.13.1-1">Authorization servers SHOULD NOT allow clients to influence their
<code>client_id</code> or <code>sub</code> value or any other claim that might cause
confusion with a genuine resource owner. Where this cannot be avoided,
authorization servers MUST provide other means for the resource
server to distinguish between access tokens authorized by a resource
owner from access tokens authorized by the client itself.<a href="#section-4.13.1-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="Acknowledgements">
<section id="section-5">
      <h2 id="name-acknowledgements">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-acknowledgements" class="section-name selfRef">Acknowledgements</a>
      </h2>
<p id="section-5-1">We would like to thank Jim Manico, Phil Hunt, Nat Sakimura, Christian
Mainka, Doug McDorman, Johan Peeters, Joseph Heenan, Brock Allen,
Vittorio Bertocci, David Waite, Nov Matake, Tomek Stojecki, Dominick
Baier, Neil Madden, William Dennis, Dick Hardt, Petteri Stenius,
Annabelle Richard Backman, Aaron Parecki, George Fletscher, Brian
Campbell, Konstantin Lapine, Tim W&amp;#252;rtele, Guido Schmitz, Hans
Zandbelt, Jared Jennings, Michael Peck, Pedram Hosseyni, and Michael
B. Jones for their valuable feedback.<a href="#section-5-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="IANA">
<section id="section-6">
      <h2 id="name-iana-considerations">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-6-1">This draft includes no request to IANA.<a href="#section-6-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="Security">
<section id="section-7">
      <h2 id="name-security-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-7-1">All relevant security considerations have been given in the
functional specification.<a href="#section-7-1" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-8">
      <h2 id="name-normative-references">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
      </h2>
<dl class="references">
<dt id="OpenID">[OpenID]</dt>
<dd>
<span class="refAuthor">Sakimura, N.</span><span class="refAuthor">, Bradley, J.</span><span class="refAuthor">, Jones, M.</span><span class="refAuthor">, de Medeiros, B.</span><span class="refAuthor">, and C. Mortimore</span>, <span class="refTitle">"OpenID Connect Core 1.0 incorporating errata set 1"</span>, <time datetime="2014-11-08">8 November 2014</time>, <span>&lt;<a href="http://openid.net/specs/openid-connect-core-1_0.html">http://openid.net/specs/openid-connect-core-1_0.html</a>&gt;</span>. </dd>
<dt id="RFC6819">[RFC6819]</dt>
<dd>
<span class="refAuthor">Lodderstedt, T., Ed.</span><span class="refAuthor">, McGloin, M.</span><span class="refAuthor">, and P. Hunt</span>, <span class="refTitle">"OAuth 2.0 Threat Model and Security Considerations"</span>, <span class="seriesInfo">RFC 6819</span>, <span class="seriesInfo">DOI 10.17487/RFC6819</span>, <time datetime="2013-01">January 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6819">https://www.rfc-editor.org/info/rfc6819</a>&gt;</span>. </dd>
<dt id="RFC6750">[RFC6750]</dt>
<dd>
<span class="refAuthor">Jones, M.</span><span class="refAuthor"> and D. Hardt</span>, <span class="refTitle">"The OAuth 2.0 Authorization Framework: Bearer Token Usage"</span>, <span class="seriesInfo">RFC 6750</span>, <span class="seriesInfo">DOI 10.17487/RFC6750</span>, <time datetime="2012-10">October 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6750">https://www.rfc-editor.org/info/rfc6750</a>&gt;</span>. </dd>
<dt id="RFC7231">[RFC7231]</dt>
<dd>
<span class="refAuthor">Fielding, R., Ed.</span><span class="refAuthor"> and J. Reschke, Ed.</span>, <span class="refTitle">"Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content"</span>, <span class="seriesInfo">RFC 7231</span>, <span class="seriesInfo">DOI 10.17487/RFC7231</span>, <time datetime="2014-06">June 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7231">https://www.rfc-editor.org/info/rfc7231</a>&gt;</span>. </dd>
<dt id="RFC3986">[RFC3986]</dt>
<dd>
<span class="refAuthor">Berners-Lee, T.</span><span class="refAuthor">, Fielding, R.</span><span class="refAuthor">, and L. Masinter</span>, <span class="refTitle">"Uniform Resource Identifier (URI): Generic Syntax"</span>, <span class="seriesInfo">STD 66</span>, <span class="seriesInfo">RFC 3986</span>, <span class="seriesInfo">DOI 10.17487/RFC3986</span>, <time datetime="2005-01">January 2005</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3986">https://www.rfc-editor.org/info/rfc3986</a>&gt;</span>. </dd>
<dt id="oauth-v2-form-post-response-mode">[oauth-v2-form-post-response-mode]</dt>
<dd>
<span class="refAuthor">Jones, M.</span><span class="refAuthor"> and B. Campbell</span>, <span class="refTitle">"OAuth 2.0 Form Post Response Mode"</span>, <time datetime="2015-04-27">27 April 2015</time>, <span>&lt;<a href="http://openid.net/specs/oauth-v2-form-post-response-mode-1_0.html">http://openid.net/specs/oauth-v2-form-post-response-mode-1_0.html</a>&gt;</span>. </dd>
<dt id="RFC7662">[RFC7662]</dt>
<dd>
<span class="refAuthor">Richer, J., Ed.</span>, <span class="refTitle">"OAuth 2.0 Token Introspection"</span>, <span class="seriesInfo">RFC 7662</span>, <span class="seriesInfo">DOI 10.17487/RFC7662</span>, <time datetime="2015-10">October 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7662">https://www.rfc-editor.org/info/rfc7662</a>&gt;</span>. </dd>
<dt id="RFC8414">[RFC8414]</dt>
<dd>
<span class="refAuthor">Jones, M.</span><span class="refAuthor">, Sakimura, N.</span><span class="refAuthor">, and J. Bradley</span>, <span class="refTitle">"OAuth 2.0 Authorization Server Metadata"</span>, <span class="seriesInfo">RFC 8414</span>, <span class="seriesInfo">DOI 10.17487/RFC8414</span>, <time datetime="2018-06">June 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8414">https://www.rfc-editor.org/info/rfc8414</a>&gt;</span>. </dd>
<dt id="RFC8418">[RFC8418]</dt>
<dd>
<span class="refAuthor">Housley, R.</span>, <span class="refTitle">"Use of the Elliptic Curve Diffie-Hellman Key Agreement Algorithm with X25519 and X448 in the Cryptographic Message Syntax (CMS)"</span>, <span class="seriesInfo">RFC 8418</span>, <span class="seriesInfo">DOI 10.17487/RFC8418</span>, <time datetime="2018-08">August 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8418">https://www.rfc-editor.org/info/rfc8418</a>&gt;</span>. </dd>
<dt id="RFC6749">[RFC6749]</dt>
<dd>
<span class="refAuthor">Hardt, D., Ed.</span>, <span class="refTitle">"The OAuth 2.0 Authorization Framework"</span>, <span class="seriesInfo">RFC 6749</span>, <span class="seriesInfo">DOI 10.17487/RFC6749</span>, <time datetime="2012-10">October 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6749">https://www.rfc-editor.org/info/rfc6749</a>&gt;</span>. </dd>
<dt id="RFC7636">[RFC7636]</dt>
<dd>
<span class="refAuthor">Sakimura, N., Ed.</span><span class="refAuthor">, Bradley, J.</span><span class="refAuthor">, and N. Agarwal</span>, <span class="refTitle">"Proof Key for Code Exchange by OAuth Public Clients"</span>, <span class="seriesInfo">RFC 7636</span>, <span class="seriesInfo">DOI 10.17487/RFC7636</span>, <time datetime="2015-09">September 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7636">https://www.rfc-editor.org/info/rfc7636</a>&gt;</span>. </dd>
</dl>
</section>
<section id="section-9">
      <h2 id="name-informative-references">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
      </h2>
<dl class="references">
<dt id="I-D.ietf-oauth-token-binding">[I-D.ietf-oauth-token-binding]</dt>
<dd>
<span class="refAuthor">Jones, M.</span><span class="refAuthor">, Campbell, B.</span><span class="refAuthor">, Bradley, J.</span><span class="refAuthor">, and W. Denniss</span>, <span class="refTitle">"OAuth 2.0 Token Binding"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-oauth-token-binding-08</span>, <time datetime="2018-10-19">19 October 2018</time>, <span>&lt;<a href="https://tools.ietf.org/html/draft-ietf-oauth-token-binding-08">https://tools.ietf.org/html/draft-ietf-oauth-token-binding-08</a>&gt;</span>. </dd>
<dt id="I-D.ietf-oauth-pop-key-distribution">[I-D.ietf-oauth-pop-key-distribution]</dt>
<dd>
<span class="refAuthor">Bradley, J.</span><span class="refAuthor">, Hunt, P.</span><span class="refAuthor">, Jones, M.</span><span class="refAuthor">, Tschofenig, H.</span><span class="refAuthor">, and M. Meszaros</span>, <span class="refTitle">"OAuth 2.0 Proof-of-Possession: Authorization Server to Client Key Distribution"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-oauth-pop-key-distribution-07</span>, <time datetime="2019-03-27">27 March 2019</time>, <span>&lt;<a href="https://tools.ietf.org/html/draft-ietf-oauth-pop-key-distribution-07">https://tools.ietf.org/html/draft-ietf-oauth-pop-key-distribution-07</a>&gt;</span>. </dd>
<dt id="RFC7800">[RFC7800]</dt>
<dd>
<span class="refAuthor">Jones, M.</span><span class="refAuthor">, Bradley, J.</span><span class="refAuthor">, and H. Tschofenig</span>, <span class="refTitle">"Proof-of-Possession Key Semantics for JSON Web Tokens (JWTs)"</span>, <span class="seriesInfo">RFC 7800</span>, <span class="seriesInfo">DOI 10.17487/RFC7800</span>, <time datetime="2016-04">April 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7800">https://www.rfc-editor.org/info/rfc7800</a>&gt;</span>. </dd>
<dt id="I-D.ietf-oauth-par">[I-D.ietf-oauth-par]</dt>
<dd>
<span class="refAuthor">Lodderstedt, T.</span><span class="refAuthor">, Campbell, B.</span><span class="refAuthor">, Sakimura, N.</span><span class="refAuthor">, Tonge, D.</span><span class="refAuthor">, and F. Skokan</span>, <span class="refTitle">"OAuth 2.0 Pushed Authorization Requests"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-oauth-par-01</span>, <time datetime="2020-02-18">18 February 2020</time>, <span>&lt;<a href="https://tools.ietf.org/html/draft-ietf-oauth-par-01">https://tools.ietf.org/html/draft-ietf-oauth-par-01</a>&gt;</span>. </dd>
<dt id="oauth_security_ubc">[oauth_security_ubc]</dt>
<dd>
<span class="refAuthor">Sun, S.-T.</span><span class="refAuthor"> and K. Beznosov</span>, <span class="refTitle">"The Devil is in the (Implementation) Details: An Empirical Analysis of OAuth SSO Systems"</span>, <time datetime="2012-10">October 2012</time>, <span>&lt;<a href="http://passwordresearch.com/papers/paper267.html">http://passwordresearch.com/papers/paper267.html</a>&gt;</span>. </dd>
<dt id="I-D.fett-oauth-dpop">[I-D.fett-oauth-dpop]</dt>
<dd>
<span class="refAuthor">Fett, D.</span><span class="refAuthor">, Campbell, B.</span><span class="refAuthor">, Bradley, J.</span><span class="refAuthor">, Lodderstedt, T.</span><span class="refAuthor">, Jones, M.</span><span class="refAuthor">, and D. Waite</span>, <span class="refTitle">"OAuth 2.0 Demonstration of Proof-of-Possession at the Application Layer (DPoP)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-fett-oauth-dpop-04</span>, <time datetime="2020-03-04">4 March 2020</time>, <span>&lt;<a href="https://tools.ietf.org/html/draft-fett-oauth-dpop-04">https://tools.ietf.org/html/draft-fett-oauth-dpop-04</a>&gt;</span>. </dd>
<dt id="subdomaintakeover">[subdomaintakeover]</dt>
<dd>
<span class="refAuthor">Liu, D.</span><span class="refAuthor">, Hao, S.</span><span class="refAuthor">, and H. Wang</span>, <span class="refTitle">"All Your DNS Records Point to Us: Understanding the Security Threats of Dangling DNS Records"</span>, <time datetime="2016-10-24">24 October 2016</time>, <span>&lt;<a href="https://www.eecis.udel.edu/~hnw/paper/ccs16a.pdf">https://www.eecis.udel.edu/~hnw/paper/ccs16a.pdf</a>&gt;</span>. </dd>
<dt id="arXiv.1704.08539">[arXiv.1704.08539]</dt>
<dd>
<span class="refAuthor">Fett, D.</span><span class="refAuthor">, Küsters, R.</span><span class="refAuthor">, and G. Schmitz</span>, <span class="refTitle">"The Web SSO Standard OpenID Connect: In-Depth Formal Security Analysis and Security Guidelines"</span>, <time datetime="2017-04-27">27 April 2017</time>, <span>&lt;<a href="http://arxiv.org/abs/1704.08539/">http://arxiv.org/abs/1704.08539/</a>&gt;</span>. </dd>
<dt id="RFC2119">[RFC2119]</dt>
<dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dt id="webauthn">[webauthn]</dt>
<dd>
<span class="refAuthor">Balfanz, D.</span><span class="refAuthor">, Czeskis, A.</span><span class="refAuthor">, Hodges, J.</span><span class="refAuthor">, Jones, J.C.</span><span class="refAuthor">, Jones, M.B.</span><span class="refAuthor">, Kumar, A.</span><span class="refAuthor">, Liao, A.</span><span class="refAuthor">, Lindemann, R.</span><span class="refAuthor">, and E. Lundberg</span>, <span class="refTitle">"Web Authentication: An API for accessing Public Key Credentials Level 1"</span>, <time datetime="2019-03-04">4 March 2019</time>, <span>&lt;<a href="https://www.w3.org/TR/2019/REC-webauthn-1-20190304/">https://www.w3.org/TR/2019/REC-webauthn-1-20190304/</a>&gt;</span>. </dd>
<dt id="arXiv.1508.04324v2">[arXiv.1508.04324v2]</dt>
<dd>
<span class="refAuthor">Mladenov, V.</span><span class="refAuthor">, Mainka, C.</span><span class="refAuthor">, and J. Schwenk</span>, <span class="refTitle">"On the security of modern Single Sign-On Protocols: Second-Order Vulnerabilities in OpenID Connect"</span>, <time datetime="2016-01-07">7 January 2016</time>, <span>&lt;<a href="http://arxiv.org/abs/1508.04324v2/">http://arxiv.org/abs/1508.04324v2/</a>&gt;</span>. </dd>
<dt id="RFC8473">[RFC8473]</dt>
<dd>
<span class="refAuthor">Popov, A.</span><span class="refAuthor">, Nystroem, M.</span><span class="refAuthor">, Balfanz, D., Ed.</span><span class="refAuthor">, Harper, N.</span><span class="refAuthor">, and J. Hodges</span>, <span class="refTitle">"Token Binding over HTTP"</span>, <span class="seriesInfo">RFC 8473</span>, <span class="seriesInfo">DOI 10.17487/RFC8473</span>, <time datetime="2018-10">October 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8473">https://www.rfc-editor.org/info/rfc8473</a>&gt;</span>. </dd>
<dt id="webappsec-referrer-policy">[webappsec-referrer-policy]</dt>
<dd>
<span class="refAuthor">Eisinger, J.</span><span class="refAuthor"> and E. Stark</span>, <span class="refTitle">"Referrer Policy"</span>, <time datetime="2017-04-20">20 April 2017</time>, <span>&lt;<a href="https://w3c.github.io/webappsec-referrer-policy">https://w3c.github.io/webappsec-referrer-policy</a>&gt;</span>. </dd>
<dt id="oauth_security_cmu">[oauth_security_cmu]</dt>
<dd>
<span class="refAuthor">Chen, E.</span><span class="refAuthor">, Pei, Y.</span><span class="refAuthor">, Chen, S.</span><span class="refAuthor">, Tian, Y.</span><span class="refAuthor">, Kotcher, R.</span><span class="refAuthor">, and P. Tague</span>, <span class="refTitle">"OAuth Demystified for Mobile Application Developers"</span>, <time datetime="2014-11">November 2014</time>, <span>&lt;<a href="http://css.csail.mit.edu/6.858/2012/readings/oauth-sso.pdf">http://css.csail.mit.edu/6.858/2012/readings/oauth-sso.pdf</a>&gt;</span>. </dd>
<dt id="oauth_security_jcs_14">[oauth_security_jcs_14]</dt>
<dd>
<span class="refAuthor">Bansal, C.</span><span class="refAuthor">, Bhargavan, K.</span><span class="refAuthor">, Delignat-Lavaud, A.</span><span class="refAuthor">, and S. Maffeis</span>, <span class="refTitle">"Discovering concrete attacks on website authorization by formal analysis"</span>, <time datetime="2014-04-23">23 April 2014</time>, <span>&lt;<a href="https://www.doc.ic.ac.uk/~maffeis/papers/jcs14.pdf">https://www.doc.ic.ac.uk/~maffeis/papers/jcs14.pdf</a>&gt;</span>. </dd>
<dt id="I-D.bradley-oauth-jwt-encoded-state">[I-D.bradley-oauth-jwt-encoded-state]</dt>
<dd>
<span class="refAuthor">Bradley, J.</span><span class="refAuthor">, Lodderstedt, T.</span><span class="refAuthor">, and H. Zandbelt</span>, <span class="refTitle">"Encoding claims in the OAuth 2 state parameter using a JWT"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-bradley-oauth-jwt-encoded-state-09</span>, <time datetime="2018-11-04">4 November 2018</time>, <span>&lt;<a href="https://tools.ietf.org/html/draft-bradley-oauth-jwt-encoded-state-09">https://tools.ietf.org/html/draft-bradley-oauth-jwt-encoded-state-09</a>&gt;</span>. </dd>
<dt id="owasp_redir">[owasp_redir]</dt>
<dd>
<span class="refTitle">"OWASP Cheat Sheet Series - Unvalidated Redirects and Forwards"</span>, <time></time>, <span>&lt;<a href="https://cheatsheetseries.owasp.org/cheatsheets/Unvalidated_Redirects_and_Forwards_Cheat_Sheet.html">https://cheatsheetseries.owasp.org/cheatsheets/Unvalidated_Redirects_and_Forwards_Cheat_Sheet.html</a>&gt;</span>. </dd>
<dt id="I-D.sakimura-oauth-jpop">[I-D.sakimura-oauth-jpop]</dt>
<dd>
<span class="refAuthor">Sakimura, N.</span><span class="refAuthor">, Li, K.</span><span class="refAuthor">, and J. Bradley</span>, <span class="refTitle">"The OAuth 2.0 Authorization Framework: JWT Pop Token Usage"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-sakimura-oauth-jpop-05</span>, <time datetime="2019-07-22">22 July 2019</time>, <span>&lt;<a href="https://tools.ietf.org/html/draft-sakimura-oauth-jpop-05">https://tools.ietf.org/html/draft-sakimura-oauth-jpop-05</a>&gt;</span>. </dd>
<dt id="I-D.ietf-oauth-closing-redirectors">[I-D.ietf-oauth-closing-redirectors]</dt>
<dd>
<span class="refAuthor">Bradley, J.</span><span class="refAuthor">, Sanso, A.</span><span class="refAuthor">, and H. Tschofenig</span>, <span class="refTitle">"OAuth 2.0 Security: Closing Open Redirectors in OAuth"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-oauth-closing-redirectors-00</span>, <time datetime="2016-02-04">4 February 2016</time>, <span>&lt;<a href="https://tools.ietf.org/html/draft-ietf-oauth-closing-redirectors-00">https://tools.ietf.org/html/draft-ietf-oauth-closing-redirectors-00</a>&gt;</span>. </dd>
<dt id="RFC8174">[RFC8174]</dt>
<dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dt id="I-D.ietf-oauth-resource-indicators">[I-D.ietf-oauth-resource-indicators]</dt>
<dd>
<span class="refAuthor">Campbell, B.</span><span class="refAuthor">, Bradley, J.</span><span class="refAuthor">, and H. Tschofenig</span>, <span class="refTitle">"Resource Indicators for OAuth 2.0"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-oauth-resource-indicators-08</span>, <time datetime="2019-09-11">11 September 2019</time>, <span>&lt;<a href="https://tools.ietf.org/html/draft-ietf-oauth-resource-indicators-08">https://tools.ietf.org/html/draft-ietf-oauth-resource-indicators-08</a>&gt;</span>. </dd>
<dt id="arXiv.1901.11520">[arXiv.1901.11520]</dt>
<dd>
<span class="refAuthor">Fett, D.</span><span class="refAuthor">, Hosseyni, P.</span><span class="refAuthor">, and R. Küsters</span>, <span class="refTitle">"An Extensive Formal Security Analysis of the OpenID Financial-grade API"</span>, <time datetime="2019-01-31">31 January 2019</time>, <span>&lt;<a href="http://arxiv.org/abs/1901.11520/">http://arxiv.org/abs/1901.11520/</a>&gt;</span>. </dd>
<dt id="I-D.ietf-oauth-mix-up-mitigation">[I-D.ietf-oauth-mix-up-mitigation]</dt>
<dd>
<span class="refAuthor">Jones, M.</span><span class="refAuthor">, Bradley, J.</span><span class="refAuthor">, and N. Sakimura</span>, <span class="refTitle">"OAuth 2.0 Mix-Up Mitigation"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-oauth-mix-up-mitigation-01</span>, <time datetime="2016-07-07">7 July 2016</time>, <span>&lt;<a href="https://tools.ietf.org/html/draft-ietf-oauth-mix-up-mitigation-01">https://tools.ietf.org/html/draft-ietf-oauth-mix-up-mitigation-01</a>&gt;</span>. </dd>
<dt id="I-D.ietf-oauth-signed-http-request">[I-D.ietf-oauth-signed-http-request]</dt>
<dd>
<span class="refAuthor">Richer, J.</span><span class="refAuthor">, Bradley, J.</span><span class="refAuthor">, and H. Tschofenig</span>, <span class="refTitle">"A Method for Signing HTTP Requests for OAuth"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-oauth-signed-http-request-03</span>, <time datetime="2016-08-08">8 August 2016</time>, <span>&lt;<a href="https://tools.ietf.org/html/draft-ietf-oauth-signed-http-request-03">https://tools.ietf.org/html/draft-ietf-oauth-signed-http-request-03</a>&gt;</span>. </dd>
<dt id="I-D.ietf-oauth-mtls">[I-D.ietf-oauth-mtls]</dt>
<dd>
<span class="refAuthor">Campbell, B.</span><span class="refAuthor">, Bradley, J.</span><span class="refAuthor">, Sakimura, N.</span><span class="refAuthor">, and T. Lodderstedt</span>, <span class="refTitle">"OAuth 2.0 Mutual-TLS Client Authentication and Certificate-Bound Access Tokens"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-oauth-mtls-17</span>, <time datetime="2019-08-23">23 August 2019</time>, <span>&lt;<a href="https://tools.ietf.org/html/draft-ietf-oauth-mtls-17">https://tools.ietf.org/html/draft-ietf-oauth-mtls-17</a>&gt;</span>. </dd>
<dt id="I-D.ietf-oauth-rar">[I-D.ietf-oauth-rar]</dt>
<dd>
<span class="refAuthor">Lodderstedt, T.</span><span class="refAuthor">, Richer, J.</span><span class="refAuthor">, and B. Campbell</span>, <span class="refTitle">"OAuth 2.0 Rich Authorization Requests"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-oauth-rar-01</span>, <time datetime="2020-02-19">19 February 2020</time>, <span>&lt;<a href="https://tools.ietf.org/html/draft-ietf-oauth-rar-01">https://tools.ietf.org/html/draft-ietf-oauth-rar-01</a>&gt;</span>. </dd>
<dt id="arXiv.1601.01229">[arXiv.1601.01229]</dt>
<dd>
<span class="refAuthor">Fett, D.</span><span class="refAuthor">, Küsters, R.</span><span class="refAuthor">, and G. Schmitz</span>, <span class="refTitle">"A Comprehensive Formal Security Analysis of OAuth 2.0"</span>, <time datetime="2016-01-06">6 January 2016</time>, <span>&lt;<a href="http://arxiv.org/abs/1601.01229/">http://arxiv.org/abs/1601.01229/</a>&gt;</span>. </dd>
<dt id="I-D.ietf-oauth-jwsreq">[I-D.ietf-oauth-jwsreq]</dt>
<dd>
<span class="refAuthor">Sakimura, N.</span><span class="refAuthor"> and J. Bradley</span>, <span class="refTitle">"The OAuth 2.0 Authorization Framework: JWT Secured Authorization Request (JAR)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-oauth-jwsreq-20</span>, <time datetime="2019-10-21">21 October 2019</time>, <span>&lt;<a href="https://tools.ietf.org/html/draft-ietf-oauth-jwsreq-20">https://tools.ietf.org/html/draft-ietf-oauth-jwsreq-20</a>&gt;</span>. </dd>
<dt id="bug.chromium">[bug.chromium]</dt>
<dd>
<span class="refTitle">"Referer header includes URL fragment when opening link using New Tab"</span>, <time></time>, <span>&lt;<a href="https://bugs.chromium.org/p/chromium/issues/detail?id=168213/">https://bugs.chromium.org/p/chromium/issues/detail?id=168213/</a>&gt;</span>. </dd>
<dt id="RFC7591">[RFC7591]</dt>
<dd>
<span class="refAuthor">Richer, J., Ed.</span><span class="refAuthor">, Jones, M.</span><span class="refAuthor">, Bradley, J.</span><span class="refAuthor">, Machulak, M.</span><span class="refAuthor">, and P. Hunt</span>, <span class="refTitle">"OAuth 2.0 Dynamic Client Registration Protocol"</span>, <span class="seriesInfo">RFC 7591</span>, <span class="seriesInfo">DOI 10.17487/RFC7591</span>, <time datetime="2015-07">July 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7591">https://www.rfc-editor.org/info/rfc7591</a>&gt;</span>. </dd>
<dt id="webcrypto">[webcrypto]</dt>
<dd>
<span class="refAuthor">Watson, M.</span>, <span class="refTitle">"Web Cryptography API"</span>, <time datetime="2017-01-26">26 January 2017</time>, <span>&lt;<a href="https://www.w3.org/TR/2017/REC-WebCryptoAPI-20170126/">https://www.w3.org/TR/2017/REC-WebCryptoAPI-20170126/</a>&gt;</span>. </dd>
</dl>
</section>
<div id="document-history">
<section id="section-appendix.a">
      <h2 id="name-document-history">
<a href="#section-appendix.a" class="section-number selfRef">Appendix A. </a><a href="#name-document-history" class="section-name selfRef">Document History</a>
      </h2>
<p id="section-appendix.a-1">[[ To be removed from the final specification ]]<a href="#section-appendix.a-1" class="pilcrow">¶</a></p>
<p id="section-appendix.a-2">-14<a href="#section-appendix.a-2" class="pilcrow">¶</a></p>
<ul>
<li id="section-appendix.a-3.1">
          <p id="section-appendix.a-3.1.1">Changes from WGLC feedback<a href="#section-appendix.a-3.1.1" class="pilcrow">¶</a></p>
</li>
<li id="section-appendix.a-3.2">
          <p id="section-appendix.a-3.2.1">Editorial changes<a href="#section-appendix.a-3.2.1" class="pilcrow">¶</a></p>
</li>
<li id="section-appendix.a-3.3">
          <p id="section-appendix.a-3.3.1">AS MUST announce PKCE support either in metadata or using deployment-specific ways (before: SHOULD)<a href="#section-appendix.a-3.3.1" class="pilcrow">¶</a></p>
</li>
</ul>
<p id="section-appendix.a-4">-13<a href="#section-appendix.a-4" class="pilcrow">¶</a></p>
<ul>
<li id="section-appendix.a-5.1">
          <p id="section-appendix.a-5.1.1">Discourage use of Resource Owner Password Credentials Grant<a href="#section-appendix.a-5.1.1" class="pilcrow">¶</a></p>
</li>
<li id="section-appendix.a-5.2">
          <p id="section-appendix.a-5.2.1">Added text on client impersonating resource owner<a href="#section-appendix.a-5.2.1" class="pilcrow">¶</a></p>
</li>
<li id="section-appendix.a-5.3">
          <p id="section-appendix.a-5.3.1">Recommend asymmetric methods for client authentication<a href="#section-appendix.a-5.3.1" class="pilcrow">¶</a></p>
</li>
<li id="section-appendix.a-5.4">
          <p id="section-appendix.a-5.4.1">Encourage use of PKCE mode "S256"<a href="#section-appendix.a-5.4.1" class="pilcrow">¶</a></p>
</li>
<li id="section-appendix.a-5.5">
          <p id="section-appendix.a-5.5.1">PKCE may replace state for CSRF protection<a href="#section-appendix.a-5.5.1" class="pilcrow">¶</a></p>
</li>
<li id="section-appendix.a-5.6">
          <p id="section-appendix.a-5.6.1">AS SHOULD publish PKCE support<a href="#section-appendix.a-5.6.1" class="pilcrow">¶</a></p>
</li>
<li id="section-appendix.a-5.7">
          <p id="section-appendix.a-5.7.1">Cleaned up discussion on auth code injection<a href="#section-appendix.a-5.7.1" class="pilcrow">¶</a></p>
</li>
<li id="section-appendix.a-5.8">
          <p id="section-appendix.a-5.8.1">AS MUST support PKCE<a href="#section-appendix.a-5.8.1" class="pilcrow">¶</a></p>
</li>
</ul>
<p id="section-appendix.a-6">-12<a href="#section-appendix.a-6" class="pilcrow">¶</a></p>
<ul>
<li id="section-appendix.a-7.1">
          <p id="section-appendix.a-7.1.1">Added updated attacker model<a href="#section-appendix.a-7.1.1" class="pilcrow">¶</a></p>
</li>
</ul>
<p id="section-appendix.a-8">-11<a href="#section-appendix.a-8" class="pilcrow">¶</a></p>
<ul>
<li id="section-appendix.a-9.1">
          <p id="section-appendix.a-9.1.1">Adapted section 2.1.2 to outcome of consensus call<a href="#section-appendix.a-9.1.1" class="pilcrow">¶</a></p>
</li>
<li id="section-appendix.a-9.2">
          <p id="section-appendix.a-9.2.1">more text on refresh token inactivity and implementation note on refresh token replay detection via refresh token rotation<a href="#section-appendix.a-9.2.1" class="pilcrow">¶</a></p>
</li>
</ul>
<p id="section-appendix.a-10">-10<a href="#section-appendix.a-10" class="pilcrow">¶</a></p>
<ul>
<li id="section-appendix.a-11.1">
          <p id="section-appendix.a-11.1.1">incorporated feedback by Joseph Heenan<a href="#section-appendix.a-11.1.1" class="pilcrow">¶</a></p>
</li>
<li id="section-appendix.a-11.2">
          <p id="section-appendix.a-11.2.1">changed occurrences of SHALL to MUST<a href="#section-appendix.a-11.2.1" class="pilcrow">¶</a></p>
</li>
<li id="section-appendix.a-11.3">
          <p id="section-appendix.a-11.3.1">added text on lack of token/cert binding support tokens issued in
  the authorization response as justification to not recommend
  issuing tokens there at all<a href="#section-appendix.a-11.3.1" class="pilcrow">¶</a></p>
</li>
<li id="section-appendix.a-11.4">
          <p id="section-appendix.a-11.4.1">added requirement to authenticate clients during code exchange
  (PKCE or client credential) to 2.1.1.<a href="#section-appendix.a-11.4.1" class="pilcrow">¶</a></p>
</li>
<li id="section-appendix.a-11.5">
          <p id="section-appendix.a-11.5.1">added section on refresh tokens<a href="#section-appendix.a-11.5.1" class="pilcrow">¶</a></p>
</li>
<li id="section-appendix.a-11.6">
          <p id="section-appendix.a-11.6.1">editorial enhancements to 2.1.2 based on feedback<a href="#section-appendix.a-11.6.1" class="pilcrow">¶</a></p>
</li>
</ul>
<p id="section-appendix.a-12">-09<a href="#section-appendix.a-12" class="pilcrow">¶</a></p>
<ul>
<li id="section-appendix.a-13.1">
          <p id="section-appendix.a-13.1.1">changed text to recommend not to use implicit but code<a href="#section-appendix.a-13.1.1" class="pilcrow">¶</a></p>
</li>
<li id="section-appendix.a-13.2">
          <p id="section-appendix.a-13.2.1">added section on access token injection<a href="#section-appendix.a-13.2.1" class="pilcrow">¶</a></p>
</li>
<li id="section-appendix.a-13.3">
          <p id="section-appendix.a-13.3.1">reworked sections 3.1 through 3.3 to be more specific on implicit
  grant issues<a href="#section-appendix.a-13.3.1" class="pilcrow">¶</a></p>
</li>
</ul>
<p id="section-appendix.a-14">-08<a href="#section-appendix.a-14" class="pilcrow">¶</a></p>
<ul>
<li id="section-appendix.a-15.1">
          <p id="section-appendix.a-15.1.1">added recommendations re implicit and token injection<a href="#section-appendix.a-15.1.1" class="pilcrow">¶</a></p>
</li>
<li id="section-appendix.a-15.2">
          <p id="section-appendix.a-15.2.1">uppercased key words in Section 2 according to RFC 2119<a href="#section-appendix.a-15.2.1" class="pilcrow">¶</a></p>
</li>
</ul>
<p id="section-appendix.a-16">-07<a href="#section-appendix.a-16" class="pilcrow">¶</a></p>
<ul>
<li id="section-appendix.a-17.1">
          <p id="section-appendix.a-17.1.1">incorporated findings of Doug McDorman<a href="#section-appendix.a-17.1.1" class="pilcrow">¶</a></p>
</li>
<li id="section-appendix.a-17.2">
          <p id="section-appendix.a-17.2.1">added section on HTTP status codes for redirects<a href="#section-appendix.a-17.2.1" class="pilcrow">¶</a></p>
</li>
<li id="section-appendix.a-17.3">
          <p id="section-appendix.a-17.3.1">added new section on access token privilege restriction based on
  comments from Johan Peeters<a href="#section-appendix.a-17.3.1" class="pilcrow">¶</a></p>
</li>
</ul>
<p id="section-appendix.a-18">-06<a href="#section-appendix.a-18" class="pilcrow">¶</a></p>
<ul>
<li id="section-appendix.a-19.1">
          <p id="section-appendix.a-19.1.1">reworked section 3.8.1<a href="#section-appendix.a-19.1.1" class="pilcrow">¶</a></p>
</li>
<li id="section-appendix.a-19.2">
          <p id="section-appendix.a-19.2.1">incorporated Phil Hunt's feedback<a href="#section-appendix.a-19.2.1" class="pilcrow">¶</a></p>
</li>
<li id="section-appendix.a-19.3">
          <p id="section-appendix.a-19.3.1">reworked section on mix-up<a href="#section-appendix.a-19.3.1" class="pilcrow">¶</a></p>
</li>
<li id="section-appendix.a-19.4">
          <p id="section-appendix.a-19.4.1">extended section on code leakage via referrer header to also cover
  state leakage<a href="#section-appendix.a-19.4.1" class="pilcrow">¶</a></p>
</li>
<li id="section-appendix.a-19.5">
          <p id="section-appendix.a-19.5.1">added Daniel Fett as author<a href="#section-appendix.a-19.5.1" class="pilcrow">¶</a></p>
</li>
<li id="section-appendix.a-19.6">
          <p id="section-appendix.a-19.6.1">replaced text intended to inform WG discussion by recommendations
  to implementors<a href="#section-appendix.a-19.6.1" class="pilcrow">¶</a></p>
</li>
<li id="section-appendix.a-19.7">
          <p id="section-appendix.a-19.7.1">modified example URLs to conform to RFC 2606<a href="#section-appendix.a-19.7.1" class="pilcrow">¶</a></p>
</li>
</ul>
<p id="section-appendix.a-20">-05<a href="#section-appendix.a-20" class="pilcrow">¶</a></p>
<ul>
<li id="section-appendix.a-21.1">
          <p id="section-appendix.a-21.1.1">Completed sections on code leakage via referrer header, attacks in
  browser, mix-up, and CSRF<a href="#section-appendix.a-21.1.1" class="pilcrow">¶</a></p>
</li>
<li id="section-appendix.a-21.2">
          <p id="section-appendix.a-21.2.1">Reworked Code Injection Section<a href="#section-appendix.a-21.2.1" class="pilcrow">¶</a></p>
</li>
<li id="section-appendix.a-21.3">
          <p id="section-appendix.a-21.3.1">Added reference to OpenID Connect spec<a href="#section-appendix.a-21.3.1" class="pilcrow">¶</a></p>
</li>
<li id="section-appendix.a-21.4">
          <p id="section-appendix.a-21.4.1">removed refresh token leakage as respective considerations have
  been given in section 10.4 of RFC 6749<a href="#section-appendix.a-21.4.1" class="pilcrow">¶</a></p>
</li>
<li id="section-appendix.a-21.5">
          <p id="section-appendix.a-21.5.1">first version on open redirection<a href="#section-appendix.a-21.5.1" class="pilcrow">¶</a></p>
</li>
<li id="section-appendix.a-21.6">
          <p id="section-appendix.a-21.6.1">incorporated Christian Mainka's review feedback<a href="#section-appendix.a-21.6.1" class="pilcrow">¶</a></p>
</li>
</ul>
<p id="section-appendix.a-22">-04<a href="#section-appendix.a-22" class="pilcrow">¶</a></p>
<ul>
<li id="section-appendix.a-23.1">
          <p id="section-appendix.a-23.1.1">Restructured document for better readability<a href="#section-appendix.a-23.1.1" class="pilcrow">¶</a></p>
</li>
<li id="section-appendix.a-23.2">
          <p id="section-appendix.a-23.2.1">Added best practices on Token Leakage prevention<a href="#section-appendix.a-23.2.1" class="pilcrow">¶</a></p>
</li>
</ul>
<p id="section-appendix.a-24">-03<a href="#section-appendix.a-24" class="pilcrow">¶</a></p>
<ul>
<li id="section-appendix.a-25.1">
          <p id="section-appendix.a-25.1.1">Added section on Access Token Leakage at Resource Server<a href="#section-appendix.a-25.1.1" class="pilcrow">¶</a></p>
</li>
<li id="section-appendix.a-25.2">
          <p id="section-appendix.a-25.2.1">incorporated Brian Campbell's findings<a href="#section-appendix.a-25.2.1" class="pilcrow">¶</a></p>
</li>
</ul>
<p id="section-appendix.a-26">-02<a href="#section-appendix.a-26" class="pilcrow">¶</a></p>
<ul>
<li id="section-appendix.a-27.1">
          <p id="section-appendix.a-27.1.1">Folded Mix up and Access Token leakage through a bad AS into new
  section for dynamic OAuth threats<a href="#section-appendix.a-27.1.1" class="pilcrow">¶</a></p>
</li>
<li id="section-appendix.a-27.2">
          <p id="section-appendix.a-27.2.1">reworked dynamic OAuth section<a href="#section-appendix.a-27.2.1" class="pilcrow">¶</a></p>
</li>
</ul>
<p id="section-appendix.a-28">-01<a href="#section-appendix.a-28" class="pilcrow">¶</a></p>
<ul>
<li id="section-appendix.a-29.1">
          <p id="section-appendix.a-29.1.1">Added references to mitigation methods for token leakage<a href="#section-appendix.a-29.1.1" class="pilcrow">¶</a></p>
</li>
<li id="section-appendix.a-29.2">
          <p id="section-appendix.a-29.2.1">Added reference to Token Binding for Authorization Code<a href="#section-appendix.a-29.2.1" class="pilcrow">¶</a></p>
</li>
<li id="section-appendix.a-29.3">
          <p id="section-appendix.a-29.3.1">incorporated feedback of Phil Hunt<a href="#section-appendix.a-29.3.1" class="pilcrow">¶</a></p>
</li>
<li id="section-appendix.a-29.4">
          <p id="section-appendix.a-29.4.1">fixed numbering issue in attack descriptions in section 2<a href="#section-appendix.a-29.4.1" class="pilcrow">¶</a></p>
</li>
</ul>
<p id="section-appendix.a-30">-00 (WG document)<a href="#section-appendix.a-30" class="pilcrow">¶</a></p>
<ul>
<li id="section-appendix.a-31.1">
          <p id="section-appendix.a-31.1.1">turned the ID into a WG document and a BCP<a href="#section-appendix.a-31.1.1" class="pilcrow">¶</a></p>
</li>
<li id="section-appendix.a-31.2">
          <p id="section-appendix.a-31.2.1">Added federated app login as topic in Other Topics<a href="#section-appendix.a-31.2.1" class="pilcrow">¶</a></p>
</li>
</ul>
</section>
</div>
<div id="authors-addresses">
<section id="section-appendix.b">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Torsten Lodderstedt</span></div>
<div dir="auto" class="left"><span class="org">yes.com</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:torsten@lodderstedt.net" class="email">torsten@lodderstedt.net</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">John Bradley</span></div>
<div dir="auto" class="left"><span class="org">Yubico</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:ve7jtb@ve7jtb.com" class="email">ve7jtb@ve7jtb.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Andrey Labunets</span></div>
<div dir="auto" class="left"><span class="org">Facebook</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:isciurus@gmail.com" class="email">isciurus@gmail.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Daniel Fett</span></div>
<div dir="auto" class="left"><span class="org">yes.com</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:mail@danielfett.de" class="email">mail@danielfett.de</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
